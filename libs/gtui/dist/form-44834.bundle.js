/*!
 * Name: gt-ui
 * SVNVersion: 1381
 * Date: 2018-04-27
 * Description: 前端框架
 */
webpackJsonp(["form"],{"./src/form/app.js":function(e,r,o){"use strict";try{angular.module("frameApp")}catch(e){angular.module("frameApp",["ui.router","ngAnimate","gm.ngCustom.control","ngResource","ngSanitize","ngCookies"])}},"./src/form/core/base/api.js":function(e,r,o){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};GM.Form={},GM.Form.CommonOper={showSuccessMsg:function(e){GM.Infomation.show(e,{type:"success",placement:"center"})},showFailureMsg:function(e){GM.Infomation.show(e,{type:"danger",placement:"center"})},getUUID:function(){var e,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];for(e=0;e<32;e++)o[e]=r[0|16*Math.random()];return o.join("")},showDialog:function(e,r,o,a){var t,s,n={iframe:e+(e.indexOf("?")>-1?"&":"?")+"version="+new Date,title:r,backdrop:"static"};if(o&&o.indexOf(",")>-1){var i=o.split(",");try{t=parseInt(i[0])+"px"}catch(e){t="1000px"}try{s=parseInt(i[1])+"px"}catch(e){s="800px"}n.width=t,n.height=s}else n.size=o;new $.zui.ModalTrigger(n).show({hidden:function(){a&&a()}})},mapFieldArray:function(e,r){for(var o=[],t=0;t<e.length;t++)"object"===a(e[t])&&e[t][r]&&o.push(e[t][r]);return o},syncAjaxGet:function(e,r,o,a){this._syncAjax("GET",e,r,o,a)},syncAjaxPost:function(e,r,o,a){this._syncAjax("POST",e,r,o,a)},_syncAjax:function(e,r,o,a,t){var s={url:r,async:!1,type:e,success:function(e){o(e)},error:function(e){a(e)}};t&&(s.data=t),$.ajax(s)},getCnFormatMoney:function(e){var r=["角","分"],o=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],a=[["元","万","亿"],["","拾","佰","仟"]],t=e<0?"欠":"";e=Math.abs(e);for(var s="",n=0;n<r.length;n++)s+=(o[Math.floor(10*e*Math.pow(10,n))%10]+r[n]).replace(/零./,"");s=s||"整",e=Math.floor(e);for(n=0;n<a[0].length&&e>0;n++){for(var i="",c=0;c<a[1].length&&e>0;c++)i=o[e%10]+a[1][c]+i,e=Math.floor(e/10);s=i.replace(/(零.)*零$/,"").replace(/^$/,"零")+a[0][n]+s}return t+s.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")},setObjectAttrVal:function(e,r,o,a){if(e){var t=r.split(".");o!=t.length-1?(e=e[t[o]],o++,this.setObjectAttrVal(e,r,o,a)):e[t[o]]=a}},cloneObject:function(e){if(null==e||"object"!==(void 0===e?"undefined":a(e)))return e;if(e instanceof Date)return(r=new Date).setTime(e.getTime()),r;if(e instanceof Array){for(var r=[],o=0,t=e.length;o<t;++o)r[o]=GM.Form.CommonOper.cloneObject(e[o]);return r}if(e instanceof Object){r={};for(var s in e)e.hasOwnProperty(s)&&(r[s]=GM.Form.CommonOper.cloneObject(e[s]));return r}throw new Error("Unable to copy obj! Its type isn't supported.")},showMapDialog:function(){if(null==window.frames.processMap.pMap){$("#mapViewDialog").dialog({title:"地图查看",autoOpen:!1,resizeable:!0,draggable:!0,show:{effect:"fadeIn",duration:500},hide:{effect:"fadeOut",duration:500},modal:!1,width:1200,height:500,zIndex:100,position:{my:"right bottom",at:"right bottom",of:window}});var e=parent.location,r=e.pathname;"html"===r.toLowerCase().substr(r.length-4,4)?r=GM.FilePath.getDirName(r):"/"===r.toLowerCase().substr(r.length-1,1)&&(r=r.substr(0,r.length-1)),window.frames.processMap.location.href=e.origin+r+"/map.html"}$("#mapViewDialog").dialog("open")}}},"./src/form/core/base/form-data.js":function(e,r,o){"use strict";o("./src/form/core/base/api.js"),GM.Form.FormData={init:function(e){this._initScopeVar(),this._bindEvents(e),GM.Form.formScope.gridQueryParams={queryType:void 0,queryValue:void 0},GM.Form.parameters.formDataSourceNames&&GM.Form.parameters.formDataSourceNames.length>0&&this._initOptions(GM.Form.formScope,GM.Form.parameters.formDataSourceNames)},_datas:{globe:{},saveKeys:{}},_initScopeVar:function(){GM.Form.formScope.result={}},_bindEvents:function(e){var r=this;GM.Form.formScope.getData=function(){"1"!==GM.Form.parameters.urlParams.startFlag?r._getData(e):GM.Form.parameters.urlParams.did&&r._getDraftData(GM.Form.parameters.urlParams.did)},GM.Form.formScope.save=function(e,o){r._saveData(!1,e,o)},GM.Form.formScope.saveAndHandOver=function(){r._saveData(!0)},GM.Form.formScope.saveDraft=function(){r._saveDraft(GM.Form.parameters.urlParams.duuid||GM.Form.parameters.urlParams.did)},GM.Form.formScope.getSingleDataGrid=function(e,o){r._getSingleDataGrid(GM.Form.formScope,e,o)},GM.Form.formScope.dataGridSelect=function(e){r._dataGridSelect(GM.Form.formScope,e),e.grid.appScope.closeThisDialog()},GM.Form.formScope.saveDialog=function(e){r._saveDialog(e),GM.Form.formScope.closeFormDialog()},GM.Form.formScope.newDataGridRecord=function(e,r,o,a){GM.Form.parameters.dataGridNewFlag=!0,GM.CommonOper.isArrayContainsEle(GM.Form.parameters.savingFormIds,r)||GM.Form.parameters.savingFormIds.push(r),GM.Form.formScope.showFormDialog(e,r,o,a,!0)},GM.Form.formScope.dgA=function(e){r._dataGridOperA(GM.Form.formScope,e)},GM.Form.formScope.dgB=function(e){r._dataGridOperB(GM.Form.formScope,e)},GM.Form.formScope.getRedisString=function(e){return r._getRedisString(e)},GM.Form.formScope.removeRedisString=function(e){r._removeRedisString(e)},GM.Form.formScope.redisString=function(e,o){r._redisString(e,o)},GM.Form.formScope.initDataGridOptions=function(e){r._initDataGridOptions(GM.Form.formScope,e)},GM.Form.formScope.initDataGridHeaders=function(e,o,a){r._getGridOption(GM.Form.formScope,e,null,null,o,a)}},_initOptions:function(e,r){if(r&&0!==r.length)for(var o=0;o<r.length;o++)if(r[o]){var a,t,s=$("div[ui-grid='"+r[o]+"Option']");s.length>0&&(a=s.attr("data-items"),t=s.attr("template-items")),this._getGridOption(e,r[o],null,null,a,t)}},_initDataGridOptions:function(e,r){var o=this,a=window.FORM_REST_URL.workflow.getDataGridDataSourceNames+"?formids="+r;GM.Form.CommonOper.syncAjaxGet(a,function(r){!0===r.success&&r.data&&o._initOptions(e,r.data)},function(e){})},_getRedisString:function(e){var r;return GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.getRedisString+"?key="+e,function(e){!0===e.success&&e.data&&(r=e.data)},function(e){}),r},_removeRedisString:function(e){GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.removeRedisString+"?key="+e,function(e){},function(e){})},_redisString:function(e,r){GM.Form.CommonOper.syncAjaxPost(window.FORM_REST_URL.workflow.getRedisString+"?key="+e,function(e){},function(e){},{key:e,data:r})},_dataGridOperA:function(e,r){var o=event.srcElement;if(o){for(var a,t,s,n=$(o).text(),i=r.grid.element.attr("template-items").split(","),c=0;c<i.length;c++){var m=i[c].split(":");if(!(m.length<3)&&m[1]==n){a=m[2],t=m[1],s=m[3].replace(/%/g,",").replace(/\$/g,":");break}}a&&this._showDataGridDlg(e,r,a,null,t,s)}},_dataGridOperB:function(e,r){var o=event.srcElement;if(o){for(var a,t,s,n,i=$(o).text(),c=r.grid.element.attr("template-items").split(","),m=0;m<c.length;m++){var l=c[m].split(":");if(!(l.length<3)&&l[1]==i){a=l[2],l[3]&&(t=l[3]),l[4]&&(s=l[4].replace(/RDS_COLON/g,":").replace(/RDS_COMMA/g,",")),l[5]&&(n=l[5]);break}}var f=this;GM.Form.parameters.urlParams.ywh||"删除"!=i&&"删除"!=$(o).attr("title")?a&&(s?GM.Alert.show("提示",s,{showCancelButton:!0},function(){f._invokeDataGridREST(e,r,a,t,n)}):f._invokeDataGridREST(e,r,a,t,n)):s?GM.Alert.show("提示",s,{showCancelButton:!0},function(){f._deleteDataGridRecordWithoutBizKey(e,r)}):f._deleteDataGridRecordWithoutBizKey(e,r)}},_deleteDataGridRecordWithoutBizKey:function(e,r){var o=r.entity.$$dgid;if(o){var a=r.grid.element.attr("ui-grid"),t="list$"+a.replace("Option","")+"$";for(var s in e)if(0===s.indexOf(t)){for(var n=0;n<e[s].length;n++)if(e[s][n].$$dgid==o){GM.CommonOper.removeItemFromArray(e[s],e[s][n],"$$dgid");break}if(e[a].data)for(n=0;n<e[a].data.length;n++)if(e[a].data[n].$$dgid==o){GM.CommonOper.removeItemFromArray(e[a].data,e[a].data[n],"$$dgid");break}}}},_showDataGridDlg:function(e,r,o,a,t,s){GM.Form.FormEngine.clearTemporaryUrlParameters();var n=r.grid.element.attr("data-items"),i=r.grid.element.attr("ui-grid");if(i&&(i=i.replace("Option","")),!GM.Form.parameters.urlParams.ywh){for(var c,m="list$"+i,l=r.entity.$$dgid,f=0;f<GM.Form.parameters.formAlias.length;f++)if(GM.Form.parameters.formAlias[f].formid==o){c=GM.Form.parameters.formAlias[f].alias;break}if(c)for(var p in c)if(e[m+"$"+p])for(f=0;f<e[m+"$"+p].length;f++)e[m+"$"+p][f].$$dgid==l&&(e.result[p]=e[m+"$"+p][f]);return GM.CommonOper.isArrayContainsEle(GM.Form.parameters.savingFormIds,o)||GM.Form.parameters.savingFormIds.push(o),void GM.Form.formScope.showFormDialog(a,o,t,s)}if(n)for(var d=n.split(","),u=0;u<d.length;u++)if(d[u]){var g=d[u].split(":");if(3===g.length){var h=g[0];0===h.indexOf("*")&&(h=h.substring(1,h.length)),GM.Form.parameters.urlParams[g[2]]=r.entity[h],GM.CommonOper.isArrayContainsEle(GM.Form.parameters.urlTempParams,g[2])||GM.Form.parameters.urlTempParams.push(g[2]);break}}GM.Form.formScope.showFormDialog(a,o,t,s),this._getData(o,!0)},_invokeDataGridREST:function(e,r,o,a,t){if(RESTURL.dg&&RESTURL.dg[o]){var s=this,n=r.grid.element.attr("formid"),i=r.grid.element.attr("data-items"),c=r.grid.element.attr("ui-grid");c&&(c=c.replace("Option",""));var m={};if(i)for(var l=i.split(","),f=0;f<l.length;f++)if(l[f]){var p=l[f].split(":");if(3===p.length){var d=p[0];0===d.indexOf("*")&&(d=d.substring(1,d.length)),m[p[2]]=r.entity[d];break}}(a&&"POST"==a.toUpperCase()?GM.Form.restful.post(window.RESTURL.dg[o],m):GM.Form.restful.get(window.RESTURL.dg[o],m)).then(function(r){!0===r.success&&n&&c?s._getSingleDataGrid(e,n,c):!1===r.success&&GM.Form.CommonOper.showFailureMsg(r.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})}else GM.Form.CommonOper.showFailureMsg("未配置["+o+"]服务。")},_dataGridSelect:function(e,r){var o=r.grid.element.attr("ui-grid");if(o){var a=e[(o=o.replace("Option",""))+"KeyParas"];if(a&&a.length>0)for(var t=0;t<a.length;t++)GM.Form.parameters.urlParams[a[t].para]=r.entity[a[t].key];e.gridQueryParams&&e.gridQueryParams.queryType&&e.gridQueryParams.queryValue&&(GM.Form.parameters.urlParams.searchType=e.gridQueryParams.queryType,GM.Form.parameters.urlParams.searchValue=e.gridQueryParams.queryValue)}this._getData(!1,!0),e.closeFormDialog()},_getSingleDataGrid:function(e,r,o){if(!GM.Form.parameters.urlParams.ywh)for(var a in e)if(0===a.indexOf("list$"+o))return;var t=this,s=angular.copy(GM.Form.parameters.urlParams);s.ywh||(s.ywh=s.did||s.duuid),e.gridQueryParams.queryValue&&(s.queryType=e.gridQueryParams.queryType,s.queryValue=e.gridQueryParams.queryValue,e.gridQueryParams={queryType:"",queryValue:""});var n={up:s},i={formids:r,dataSourceName:o,urlParameters:JSON.stringify(n)};GM.Form.restful.get(GM.Form.parameters.servers.getSingleDataGridServer,i).then(function(r){!0===r.success&&r.data&&t._bindDataGrid(e,o,r.data)},function(e){})},_getGridOption:function(e,r,o,a,t,s){var n=r+"Option";e[n]={};var i={},c=new GM.Form.gmTable,m=[],l=[];if(s)for(var f=s.split(","),p=0;p<f.length;p++)if(""!=f[p]){var d=f[p].split(":");m.push({name:d[1],click:d[0]})}if(t){f=t.split(",");var u=[];for(p=0;p<f.length;p++)if(f[p]&&0!==f[p].indexOf("*")){d=f[p].split(":");l.push({name:d[0],displayName:d[1],enableColumnMenu:!1,cellTooltip:!0}),3===d.length&&u.push({key:d[0],para:d[2]})}u.length>0&&(e[r+"KeyParas"]=u)}else if(a&&a.length>0)for(p=0;p<a.length;p++)l.push({name:a[p],displayName:a[p],enableColumnMenu:!1,cellTooltip:!0});if(m.length>0){var g=c.getCellTemplate(m);l.push({name:"operate",displayName:"操作",enableColumnMenu:!1,cellTemplate:g})}i.data=o,i.columnDefs=l,e[n]=i,GM.Form.timeout(function(){c.updateSize()},500)},_bindDataGrid:function(e,r,o){for(var a in o)if(!r||a==r||a=="page__"+r){if(0===a.indexOf("dg__"))if(o[a]instanceof Array)"landtree"!=e.pstyle&&!0!==e.isDataComplex||!e.globalTreeData[a]||(e.globalTreeData[a]=o[a]);else{var t=o[a],s=$("div[ui-grid='"+a+"Option']").attr("data-items"),n=$("div[ui-grid='"+a+"Option']").attr("template-items");this._getGridOption(e,a,t.data.page.records,t.headList,s,n)}a&&0===a.indexOf("page__")&&(e[a]=o[a])}},_getDraftData:function(e){GM.Form.restful.get(RESTURL.process.getDraftInfo+"?id="+e).then(function(e){!0===e.success&&null!=e.data&&(GM.Form.formScope.result=JSON.parse(e.data))},function(e){})},_saveDraft:function(e){var r={id:e,userId:top.GM.userInfo.loginName,appId:top.GM.AppInfo.id,processDefId:GM.Form.parameters.urlParams.processDefId,processName:GM.Form.parameters.urlParams.processName,processKey:GM.Form.parameters.urlParams.processKey},o=angular.element("[data-role='bizname']");o&&o>0&&(r.bizName=o.val()),GM.Form.restful.get(RESTURL.process.saveDraftBaseInfo,r).then(function(o){!0===o.success&&(r={id:e,data:_this._getSavingData()},GM.Form.restful.post(RESTURL.process.saveDraftInfo,r).then(function(e){!0===e.success?GM.Form.CommonOper.showSuccessMsg("保存成功！"):GM.Form.CommonOper.showFailureMsg(e.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)}))},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})},_getData:function(e,r){var o=this,a={formids:e||GM.Form.parameters.formIds.join(","),urlParameters:JSON.stringify(GM.Form.parameters.urlParams)};GM.Form.restful.get(GM.Form.parameters.servers.getDataServer,a).then(function(e){if(!1!==e.success){if(o._datas.globe=e.data,Object.keys(e.data).forEach(function(e){if(e.startsWith("svc:")){var r=e.substring(4,e.length);GM.Form.CommonOper.syncAjaxGet(window.RESTURL.fr[r]+"?ywh="+GM.Form.parameters.urlParams.ywh).then(function(r){!0===r.success&&r.data&&(o._datas.globe[e]=r.data)},function(e){})}}),o._datas.globe.treeKey)for(var a in o._datas.globe)"treeKey"==a||o._datas.globe.treeKey[a]||(GM.Form.formScope.result[a]=o._datas.globe[a]);else if(r){for(var a in GM.Form.formScope.result)o._datas.globe[a]&&(a.indexOf("dg__")<0?!$.isEmptyObject(o._datas.globe[a])&&$.isEmptyObject(GM.Form.formScope.result[a])&&(GM.Form.formScope.result[a]=o._datas.globe[a]):0===a.indexOf("dg__")?o._datas.globe[a].data.page.records.length>0&&0===GM.Form.formScope.result[a].data.page.records.length&&(GM.Form.formScope.result[a]=o._datas.globe[a]):0===a.indexOf("page__")&&o._datas.globe[a].totalItems>0&&0===GM.Form.formScope.result[a].totalItems&&(GM.Form.formScope.result[a]=o._datas.globe[a]));for(var a in o._datas.globe)GM.Form.formScope.result[a]&&!$.isEmptyObject(GM.Form.formScope.result[a])||(GM.Form.formScope.result[a]=o._datas.globe[a])}else GM.Form.formScope.result=o._datas.globe;o._bindDataGrid(GM.Form.formScope,null,o._datas.globe)}else GM.Form.CommonOper.showFailureMsg("页面加载数据失败："+e.message)},function(e){GM.Form.CommonOper.showFailureMsg("页面加载数据失败："+e.message)})},_getSavingData:function(){var e;return e=this._datas.globe.treeKey?angular.copy(this._datas.globe):angular.copy(GM.Form.formScope.result),e=JSON.stringify(e)},_setGridDataWithTempData:function(e){if(GM.Form.formScope[e+"Option"]){var r="list$"+e;for(var o in GM.Form.formScope)if(!(o.indexOf(r)<0)){GM.Form.formScope[e+"Option"].data&&0!==GM.Form.formScope[e+"Option"].data.length||(GM.Form.formScope[e+"Option"].data=[]);for(var a=0;a<GM.Form.formScope[o].length;a++){for(var t,s=GM.Form.formScope[o][a].$$dgid,n=0;n<GM.Form.formScope[e+"Option"].data.length;n++)if(GM.Form.formScope[e+"Option"].data[n].$$dgid==s){t=n;break}if(t||0===t){for(var i in GM.Form.formScope[o][a])GM.Form.formScope[e+"Option"].data[t][i]=GM.Form.formScope[o][a][i];t=void 0}else GM.Form.formScope[e+"Option"].data.push(angular.copy(GM.Form.formScope[o][a]))}}GM.Form.parameters.dataGridNewFlag=!1}},_saveDialog:function(e){if(GM.Form.formScope.dialogParameter.formid){var r=this;if(GM.Form.parameters.urlParams.ywh){var o={};if(angular.copy(GM.Form.parameters.urlParams,o),GM.Form.formScope.dialogParameter.params)for(var a in GM.Form.formScope.dialogParameter.params)o[a]=GM.Form.formScope.dialogParameter.params[a];var t={formids:GM.Form.formScope.dialogParameter.formid,urlParameters:JSON.stringify(o),keys:JSON.stringify(r._datas.saveKeys),data:r._getSavingData()};GM.Form.CommonOper.syncAjaxPost(GM.Form.parameters.servers.saveDataServer,function(e){!0===e.success?GM.Form.CommonOper.showSuccessMsg("保存成功"):GM.Form.CommonOper.showFailureMsg(e.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)},t)}else{var s=window.FORM_REST_URL.workflow.getAnalyzedParam+"?formid="+GM.Form.formScope.dialogParameter.formid;GM.Form.CommonOper.syncAjaxGet(s,function(o){if(!0===o.success){for(var a,t,s=0;s<GM.Form.parameters.formAlias.length;s++)if(GM.Form.parameters.formAlias[s].formid==GM.Form.formScope.dialogParameter.formid){GM.Form.parameters.formAlias[s].alias=angular.copy(o.data),t=!0;break}for(var n in t||GM.Form.parameters.formAlias.push({formid:GM.Form.formScope.dialogParameter.formid,alias:angular.copy(o.data)}),o.data)if(GM.Form.formScope.result[n]){var i="list$"+e+"$"+n;if(GM.Form.parameters.dataGridNewFlag||!GM.Form.formScope.result[n].$$dgid)a||GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.getUUID,function(e){a=e.data},function(e){}),GM.Form.formScope.result[n].$$dgid=a,GM.Form.formScope[i]||(GM.Form.formScope[i]=[]),GM.Form.formScope.result[n].ROW_ID||(GM.Form.formScope.result[n].ROW_ID=GM.Form.formScope[i].length+1),GM.Form.formScope[i].push(angular.copy(GM.Form.formScope.result[n])),r._setGridDataWithTempData(e);else for(s=0;s<GM.Form.formScope[i].length;s++)if(GM.Form.formScope[i][s].$$dgid==GM.Form.formScope.result[n].$$dgid){GM.Form.formScope[i][s]=angular.copy(GM.Form.formScope.result[n]),r._setGridDataWithTempData(e);break}}}},function(e){})}}},_pretreatedSavingData:function(){for(var e in GM.Form.formScope)if(!(e.indexOf("list$")<0)){var r=e.split("$");if(!(r.length<3)){var o=r[2],a=GM.Form.formScope[e];for(var t in GM.Form.formScope.result)if(o==t){GM.Form.formScope.result[t]instanceof Array||(GM.Form.formScope.result[t]=[]);for(var s=0;s<a.length;s++){for(var n=-1,i=0;i<GM.Form.formScope.result[t].length;i++)if(GM.Form.formScope.result[t][i].$$dgid&&GM.Form.formScope.result[t][i].$$dgid==a[s].$$dgid){n=i;break}n>-1?GM.Form.formScope.result[t][i]=a[s]:GM.Form.formScope.result[t].push(a[s])}break}}}},_saveData:function(e,r,o){"1"==GM.Form.parameters.urlParams.startFlag&&this._pretreatedSavingData();var a={urlParameters:JSON.stringify(GM.Form.parameters.urlParams),keys:JSON.stringify(this._datas.saveKeys),data:this._getSavingData()};GM.Form.parameters.savingFormIds&&GM.Form.parameters.savingFormIds.length>0?a.formids=GM.Form.parameters.savingFormIds.join(","):a.formids=GM.Form.parameters.formIds.join(","),GM.Form.CommonOper.syncAjaxPost(GM.Form.parameters.servers.saveDataServer,function(a){if(!0===a.success){if(r)return void r();!0===e?GM.Form.formScope.handOver():GM.Form.CommonOper.showSuccessMsg("保存成功")}else o&&o(),GM.Form.CommonOper.showFailureMsg(a.message)},function(e){o&&o(),GM.Form.CommonOper.showFailureMsg(e.message)},a)}}},"./src/form/core/base/form-engine.js":function(module,exports,__webpack_require__){"use strict";__webpack_require__("./src/form/core/base/api.js"),__webpack_require__("./src/form/core/base/workflow.js"),__webpack_require__("./src/form/core/base/form-data.js"),__webpack_require__("./src/form/core/base/form-webgis.js"),GM.Form.formScope=void 0,GM.Form.restful=void 0,GM.Form.validationObject=void 0,GM.Form.ngDialog=void 0,GM.Form.gmTable=void 0,GM.Form.filter=void 0,GM.Form.timeout=void 0,GM.Form.parameters={appId:void 0,serviceAppKey:void 0,urlParams:void 0,urlTempParams:[],userInfo:{realName:null==top.GM.userInfo?"":top.GM.userInfo.realName,loginName:null==top.GM.userInfo?"":top.GM.userInfo.loginName},dataLoaded:!1,formValid:!0,formIds:[],savingFormIds:[],saveLayerName:void 0,servers:{getDataServer:void 0,saveDataServer:void 0,getHandOverVarServer:void 0,updateBizFlowInfoServer:void 0,getSingleDataGridServer:void 0},formDataSourceNames:[],dataGridNewFlag:!1,formAlias:[]},GM.Form.FormEngine={_functions:{beforeGetData:[],afterGetData:[],pageLoaded:[]},_initScopeVar:function(){GM.Form.formScope.settings={layoutUrl:void 0,forms:[],tabs:[],prints:[],buttons:[],topUrl:void 0,showBottom:!1,loadWebGIS:!1},GM.Form.formScope.draftInfo={key:void 0},GM.Form.formScope.dataLoaded=!1,GM.Form.formScope.hasInitCalcs=!1},init:function(e,r,o,a,t,s,n){if(GM.Form.parameters.urlParams=GM.LayoutOper.getURLParams(window.location.href),GM.Form.parameters.appId=GM.Form.parameters.urlParams.appId,GM.Form.parameters.serviceAppKey=GM.Form.parameters.urlParams.serviceAppKey,GM.Form.parameters.urlParams.serviceAppKey)for(var i in GM.Form.parameters.servers)GM.Form.parameters.servers[i]=this._getFormServiceUrl(GM.Form.parameters.urlParams.serviceAppKey)+FORM_REST_URL.form[i];GM.Form.formScope=e,GM.Form.restful=r,GM.Form.validationObject=o,GM.Form.filter=a,GM.Form.ngDialog=t,GM.Form.gmTable=s,GM.Form.timeout=n,this._initScopeVar(),GM.Form.formScope?top.GM.userInfo?(this._loadPage(),this._bindEvents(),this._doAfterLoadPage(GM.Form.formScope)):this.showFailureMsg("无法获取登录用户信息！"):this.showFailureMsg("无法初始化上下文！")},getAppServerUrl:function(e){var r=this._getFormServiceUrl(e||GM.Form.parameters.urlParams.serviceAppKey);if(r)return"/"==r.substring(r.length-1,r.length)&&(r=r.substring(0,r.length-1)),r.substring(0,r.lastIndexOf("/"))},clearTemporaryUrlParameters:function(){if(GM.Form.parameters.urlTempParams.length>0)for(var e=0;e<GM.Form.parameters.urlTempParams.length;e++)GM.Form.parameters.urlParams[GM.Form.parameters.urlTempParams[e]]&&(GM.Form.parameters.urlParams[GM.Form.parameters.urlTempParams[e]]=void 0)},_doAfterLoadPage:function(e){var r=this;GM.Form.timeout(function(){$(".nav li a[data-target]").each(function(){var e=$(this).attr("data-target").replace("#",""),r=GM.Form.CommonOper.getUUID(),o=$(this).parent("li").parent("ul").parent("div").next(".div-content").find("div[id='"+e+"']");o.length>0&&(o.attr("id",r),$(this).attr("data-target","#"+r))}),!1===e.hasInitCalcs&&angular.element("[calc-exp]").length>0&&(r._watchCalcExp(e),e.hasInitCalcs=!0)},500)},_getFormServiceUrl:function(e){var r=null;if(null==r)try{for(var o=0;o<CONFIG_JSON.length;o++)if(e===CONFIG_JSON[o].app){r=CONFIG_JSON[o].value+"form/";break}}catch(e){r=FORM_SERVER,console.log(e)}return r},_bindEvents:function _bindEvents(){var _this=this;GM.Form.formScope.dateAdd=function(e,r){if(isNaN(r))return"";r=parseFloat(r);try{var o=new Date(e);o.setDate(o.getDate()+r);var a=o.getFullYear().toString(),t=o.getMonth()+1;t=t<10?"0"+t:t.toString();var s=o.getDate();return a+"-"+t+"-"+(s=s<10?"0"+s:s.toString())}catch(e){}return""},GM.Form.formScope.dateDiff=function(e,r){try{var o=new Date(e);return(new Date(r)-o)/864e5}catch(e){}},GM.Form.formScope.invokePlugin=function(e,r){_this._clickEvent(e,r)},GM.Form.formScope.treeConfig={activeNode:"treeEvent"},GM.Form.formScope.treeEvent=function(e){_this._treeConfig(GM.Form.formScope,e)},GM.Form.formScope.goBack=function(){top.goPendingPage(GM.Form.parameters.urlParams.box)},GM.Form.formScope.print=function(e,r){_this._print(r||GM.Form.formScope.taskInfo.bizKey,e,top.GM.AppInfo.id)},GM.Form.formScope.showFormDialog=function(e,r,o,a,t){t&&_this.clearTemporaryUrlParameters(),_this._showFormDialog(GM.Form.formScope,e,r,o,a)},GM.Form.formScope.closeFormDialog=function(){GM.Form.Dialog.close()},GM.Form.formScope.formLoaded=function(){_this._formLoaded(GM.Form.formScope)},GM.Form.formScope.isCbChecked=function(e,r){return _this._isCheckBoxChecked(GM.Form.formScope,e,r)},GM.Form.formScope.cbCheck=function(e,r,o){_this._cbCheck(GM.Form.formScope,e,r,o)},GM.Form.formScope.dialogButtonClick=function(s){for(var arr=s.split(";"),i=0;i<arr.length;i++)if(arr[i]){var ss=arr[i],c=ss.substring(1,1);";"!=c&&"'"!=c&&'"'!=c&&(c="GM.Form.formScope."),ss=c+ss,ss=ss.replace(/RDS_L_PAR/g,"(").replace(/RDS_R_PAR/g,")").replace(/RDS_COLON/g,":").replace(/RDS_COMMA/g,",").replace(/RDS_S_QUOTATION/g,"'").replace(/RDS_D_QUOTATION/g,'"'),eval(ss)}},GM.Form.formScope.$watch("dataLoaded",function(){!0===GM.Form.formScope.dataLoaded&&!1===GM.Form.formScope.hasInitCalcs&&angular.element("[calc-exp]").length>0&&(_this._watchCalcExp(GM.Form.formScope),GM.Form.formScope.hasInitCalcs=!0)})},_watchCalcExp:function _watchCalcExp(scope){var _this=this;if(angular.element(":text[calc-exp='user'][ng-model],textarea[calc-exp='user'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}vCur&&""!=vCur||GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,top.GM.userInfo.realName)})}),angular.element(":text[calc-exp='userid'][ng-model],textarea[calc-exp='userid'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}vCur&&""!=vCur||GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,top.GM.userInfo.loginName)})}),angular.element(":text[calc-exp='org'][ng-model],textarea[calc-exp='org'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}if(!vCur||""==vCur){if(top.GM.userInfo.organizations.length>0)for(var orgs=[],i=0;i<top.GM.userInfo.organizations.length;i++)orgs.push(top.GM.userInfo.organizations[i].name);GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,orgs.join(","))}})}),angular.element(":text[calc-exp='sysdate'][ng-model],textarea[calc-exp='sysdate'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}if(!vCur||""==vCur){var dt=new Date,vYear=dt.getFullYear(),vMonth=(dt.getMonth()<9?"0":"")+(dt.getMonth()+1),vDate=(dt.getDate()<10?"0":"")+dt.getDate(),vSysDate=vYear+"-"+vMonth+"-"+vDate;GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,vSysDate)}})}),angular.element("[calc-exp][calc-exp!='user'][calc-exp!='userid'][calc-exp!='sysdate']").length>0){var arrCalcOpers=["+","-","*","/","^","%","(",")",","];angular.element("[calc-exp][calc-exp!='user'][calc-exp!='userid'][calc-exp!='sysdate']").each(function(){var sCalcExp=$(this).attr("calc-exp"),isCn=0===sCalcExp.indexOf("cn(");isCn&&(sCalcExp=sCalcExp.substring(3,sCalcExp.length-1));for(var sModel=$(this).attr("ng-model"),sDigits=$(this).attr("digits"),arrEleBinds=[],curEleBind="",sNewCalcExp="",i=0;i<sCalcExp.length;i++)arrCalcOpers.containsObj(sCalcExp[i])||i===sCalcExp.length-1?(""!=curEleBind&&(i===sCalcExp.length-1&&(curEleBind+=sCalcExp[i]),arrEleBinds.push(curEleBind.replace(")","")),curEleBind=""),sNewCalcExp+=sCalcExp[i],i<sCalcExp.length-1&&!arrCalcOpers.containsObj(sCalcExp[i+1])&&(sCalcExp[i+1]<"0"||sCalcExp[i+1]>"9")&&(sNewCalcExp+="GM.Form.formScope.")):(0===i&&(sCalcExp[i]<"0"||sCalcExp[i]>"9")&&(sNewCalcExp="GM.Form.formScope."),curEleBind+=sCalcExp[i],sNewCalcExp+=sCalcExp[i]);for(var i=0;i<arrEleBinds.length;i++)scope.$watch(arrEleBinds[i],function(){var curVal,curSign="",sLastExp="",isString=!1;if(0===sNewCalcExp.indexOf("GM.Form.formScope.dateAdd")||0===sNewCalcExp.indexOf("GM.Form.formScope.dateDiff"))isString=!0,sLastExp=sNewCalcExp;else for(var uu=0;uu<sNewCalcExp.length;uu++)if(arrCalcOpers.containsObj(sNewCalcExp[uu])||uu===sNewCalcExp.length-1)if(uu===sNewCalcExp.length-1&&(curSign+=sNewCalcExp[uu]),""!=curSign){try{curVal=eval(curSign)}catch(e){curVal=void 0}var vLastOper=uu===sNewCalcExp.length-1?"":sNewCalcExp[uu];curVal?isNaN(curVal)?(sLastExp+=curVal,!1===isString&&(isString=!0)):sLastExp+=parseFloat(curVal).toFixed(6)+vLastOper:sLastExp+="0"+vLastOper,curSign=""}else sLastExp+=sNewCalcExp[uu];else curSign+=sNewCalcExp[uu];try{if(!0===isString)0===sLastExp.indexOf("GM.Form.formScope.dateAdd")||0===sLastExp.indexOf("GM.Form.formScope.dateDiff")?GM.Form.CommonOper.setObjectAttrVal(scope,sModel,0,eval(sLastExp)):GM.Form.CommonOper.setObjectAttrVal(scope,sModel,0,sLastExp);else if(sDigits&&""!=sDigits&&(sLastExp="("+sLastExp+").toFixed("+sDigits+").trimNumber()"),isCn)eval("GM.Form.formScope."+sModel+"='"+formCommonOper.getCnFormatMoney(eval(sLastExp))+"'");else try{var vCalResult=eval(sLastExp);"NaN"==vCalResult&&(vCalResult=""),GM.Form.CommonOper.setObjectAttrVal(scope,sModel,0,vCalResult)}catch(e){}}catch(e){}})})}},_cbCheck:function(e,r,o,a){if(a&&""!=a)for(var t=angular.element(r.target).prop("checked"),s=o.split("."),n=e,i=0;i<s.length;i++){if(t&&!n[s[i]])n[s[i]]=i<s.length-1?{}:a;else if(i==s.length-1){var c=n[s[i]].split(",");t&&!GM.CommonOper.isArrayContainsEle(c,a)?c.push(a):!t&&GM.CommonOper.isArrayContainsEle(c,a)&&GM.CommonOper.removeItemFromArray(c,a),n[s[i]]=c.join(",")}n=n[s[i]]}},_formLoaded:function(e){var r=[];angular.element("[ui-grid]").each(function(){r.push(angular.element(this).attr("ui-grid").replace("Option",""))}),GM.Form.FormData._initOptions(e,r)},_isCheckBoxChecked:function(e,r,o){if(!r||""==r||!o||""==o)return!1;for(var a=r.split("."),t=e,s=0;s<a.length;s++){if(!t[a[s]])return!1;t=t[a[s]]}if(!t||""==t)return!1;var n=t.split(",");return GM.CommonOper.isArrayContainsEle(n,o)},_showFormDialog:function(e,r,o,a,t){if(e.initedDlgFormIds||(e.initedDlgFormIds=[]),GM.CommonOper.isArrayContainsEle(e.initedDlgFormIds,o)?e.initedDlgFormIds.push(o):e.initDataGridOptions(o),e.formInfos||(e.formInfos=[]),!r){for(var s=0;s<e.formInfos.length;s++)if(e.formInfos[s].formid==o){r=e.formInfos[s].url;break}r||GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.getFormInfoById+"?formid="+o,function(a){!0===a.success&&a.data&&(r="views/forms/"+a.data.dir,e.formInfos.push({formid:o,url:r}))},function(e){})}r&&r.toLowerCase().indexOf("views/forms")<0&&(r="views/forms/"+r);var n={formid:o,title:a,url:r};if(t){var i=t.split(","),c=[];for(s=0;s<i.length;s++){var m=i[s].split(":");c.push({name:m[0],click:m[1],id:m[2]})}n.buttons=c}e.dialogParameter=n,GM.Form.Dialog=GM.Form.ngDialog.open({template:__webpack_require__("./src/form/core/views/model/dialog.html"),scope:e,plain:!0})},_print:function(e,r,o){var a=window.FORM_REST_URL.workflow.printConfigUrl+"?appid="+o;GM.Form.CommonOper.syncAjaxGet(a,function(e){!0===e.success&&e.data&&e.data.length>0&&(a="http://"+e.data[0].ftpHost+":"+e.data[0].ftpPort+"/"+e.data[0].ftpApp+"/")},function(e){});var t={code:r,appid:o,param:e},s=window.FORM_REST_URL.workflow.print;GM.Form.restful.post(s,t).then(function(e){if(!0===e.success&&e.data)for(var r=e.data.split(";"),o=0;o<r.length;o++)if(""!==r[o]){var t=r[o].replace(/\\/g,"/");0===t.indexOf("./")?t=t.substring(1,t.length):0!==t.indexOf("/")&&(t="/"+t),top.window.open(a+t)}})},_treeConfig:function(e,r){e.treeFormKey=pNode.formid+";"+pNode.sxh+";"+pNode.subtype},_clickEvent:function(e,r){var o=this,a=r.split(",");"goBack"==r?o._doClick(a):top.GM.LayoutOper.validateForm(GM.Form.validationObject,e.allForms,function(){GM.Form.formScope.settings.formValid=!0,o._doClick(a)},function(){GM.Form.formScope.settings.formValid=!1,GM.Form.CommonOper.showFailureMsg("表单验证不通过，请先根据页面提示进行修改")})},_doClick:function _doClick(names){0!==names.length&&(eval("GM.Form.formScope."+names[0]+"()"),names.splice(0,1),this._doClick(names))},_pushFormId:function(e){GM.CommonOper.addUniqueEle(GM.Form.parameters.formIds,e)},_pushSavingFormId:function(e){GM.CommonOper.addUniqueEle(GM.Form.parameters.savingFormIds,e)},_getPages:function(e){var r=[];return this._retrievePages(r,e),r},_retrievePages:function(e,r){for(var o=0;o<r.length;o++)r[o].children?this._retrievePages(e,r[o].children):(r[o].formid&&"map"!=r[o].formid&&(this._pushFormId(r[o].formid),!0!==r[o].save&&"true"===GM.LayoutOper.getParamsValue(r[o].url,"readonly")||this._pushSavingFormId(r[o].formid)),e.push(r[o]))},_getLayoutUrl:function(e){return 0===(e=e||"tab").indexOf("url:")?e.substring(4,e.length):STATIC_RESOURCES_PATH+"dist/core-views/layout/"+e+".html"},_loadPage:function(){var e=this;if(GM.Form.Workflow.init(),GM.Form.parameters.urlParams.formid)GM.Form.formScope.settings.layoutUrl=e._getLayoutUrl("raw"),e._pushFormId(GM.Form.parameters.urlParams.formid),GM.Form.parameters.dataLoaded=!0;else{var r=window.FORM_REST_URL.workflow.getTaskConfig+"?processDefId="+GM.Form.parameters.urlParams.processDefId+"&taskKey=";GM.Form.formScope.taskInfo.bizKey?(GM.Form.formScope.settings.topUrl=STATIC_RESOURCES_PATH+"/dist/core-views/layout/top.html",r+=encodeURIComponent(GM.Form.formScope.taskInfo.taskKey),GM.Form.formScope.settings.showBottom="查看"!=GM.Form.formScope.taskInfo.name):(r+=encodeURIComponent("起草"),GM.Form.formScope.settings.showBottom=!0),GM.Form.CommonOper.syncAjaxGet(r,function(r){if(!0===r.success&&r.data&&(GM.Form.formScope.settings.layoutUrl=e._getLayoutUrl(r.data.style?r.data.style:"tab"),GM.Form.formScope.settings.tabs=r.data.forms,GM.Form.formScope.settings.forms=e._getPages(r.data.forms),GM.Form.formScope.settings.buttons=r.data.buttons,GM.Form.formScope.settings.prints=r.data.prints,r.data.webgis&&(GM.Form.formScope.settings.loadWebGIS=!!r.data.webgis),GM.Form.formScope.settings.forms&&GM.Form.formScope.settings.forms.length>0))for(var o=0;o<GM.Form.formScope.settings.forms.length;o++)GM.Form.formScope.settings.forms[o].formid&&(e._pushFormId(GM.Form.formScope.settings.forms[o].formid),!0===GM.Form.formScope.settings.forms[o].save&&e._pushSavingFormId(GM.Form.formScope.settings.forms[o].formid))},function(e){})}}}},"./src/form/core/base/form-webgis.js":function(e,r,o){"use strict";window.formWebgis={init:function(){GM.Form.formScope.graphStat={}},savePlots:function(e,r,o){var a={ywh:e,strParams:JSON.stringify(r),asDraft:!0===o?"1":"0"};return GM.Form.restful.post(RESTURL.graph.savePlots,null,a)},saveGraphStatics:function(){if(GM.Form.parameters.saveLayerName){var e=[],r=[],o={layerName:GM.Form.parameters.saveLayerName},a=!1,t=null;if(GM.Form.formScope.graphStat.hasOwnProperty("polygon")&&(e=GM.Form.formScope.graphStat.polygon,a=GM.GIS.ExternalApi.saveJXPolygons(e,GM.Form.formScope),t=GM.GIS.ExternalApi.getJhObjectIDName()),!1===a)return!1;GM.Form.formScope.graphStat.statistics&&(o.statistics=GM.Form.formScope.graphStat.statistics);for(var s=0;s<e.length;s++){var n=e[s].feature&&e[s].feature.get(t)?e[s].feature.get(t):void 0;n=n&&""!=n?n:e[s].objectid,r.push({polygonNum:e[s].polygonNum,area:e[s].area,name:e[s].name,strGeom:e[s].strGeom,objectid:n})}return o.polygon=r,GM.Form.formScope.saveGraphParam=o,!0}}}},"./src/form/core/base/workflow.js":function(module,exports,__webpack_require__){"use strict";__webpack_require__("./src/form/core/base/api.js"),__webpack_require__("./src/form/office/services/agency-services.js"),GM.Form.Workflow={init:function(){var e=this;if(GM.Form.formScope.taskInfo={bizKey:GM.Form.parameters.urlParams.ywh,draftBizKey:GM.Form.parameters.urlParams.did||GM.Form.parameters.urlParams.duuid,processDefId:GM.Form.parameters.urlParams.processDefId,processKey:GM.Form.parameters.urlParams.processKey,processName:GM.Form.parameters.urlParams.processName,taskKey:GM.Form.parameters.urlParams.taskKey,isClaimed:!1,bizName:GM.Form.parameters.urlParams.caseTitle,startTime:void 0,forbid:"1"==GM.Form.parameters.urlParams.forbid,boxName:GM.Form.parameters.urlParams.box||"agency"},GM.Form.parameters.urlParams.ywh){var r=window.FORM_REST_URL.workflow.getProcessInstanceByBizKey+"?bizKey="+GM.Form.parameters.urlParams.ywh;GM.Form.restful.get(r).then(function(e){!0===e.success&&e.data&&(GM.Form.formScope.taskInfo.startTime=e.data.startTime)},function(e){})}GM.Form.formScope.handOver=function(){window.Dialog=GM.Form.ngDialog.open({template:STATIC_RESOURCES_PATH+"/dist/core-views/handOver.html",scope:GM.Form.formScope})},GM.Form.formScope.startProcessAndHandOver=function(){GM.Form.formScope.startProcess(!0,!0)},GM.Form.formScope.startProcess=function(r,o){e._startProcess(r,o)},GM.Form.formScope.claimOrUnclaim=function(r){e._claimOrUnclaim(r)},GM.Form.formScope.showWfGraph=function(){GM.Form.formScope.blankTitle="流程图",GM.Form.formScope.htmlContent='<img src="'+FORM_REST_URL.workflow.getHighLightTask+"?bizKey="+GM.Form.formScope.taskInfo.bizKey+'" style="margin-top:30px;"/>',Dialog=GM.Form.ngDialog.open({template:STATIC_RESOURCES_PATH+"/dist/core-views/model/blank.html",scope:GM.Form.formScope})},e._isTaskClaimed(),e._initBizFlowDetails()},_claimOrUnclaim:function(e){var r,o,a;"claim"===e?(r="确认签收？",o=FORM_REST_URL.workflow.claimTask,a="签收失败"):(r="确认放弃？",o=FORM_REST_URL.workflow.unclaimTask,a="放弃签收失败"),GM.Alert.show(r,"",null,function(){GM.Form.restful.get(o,{bizKey:GM.Form.formScope.taskInfo.bizKey,taskKey:GM.Form.formScope.taskInfo.taskKey,userId:GM.Form.parameters.userInfo.loginName}).then(function(e){if(!0===e.success){var r="";for(var o in GM.Form.parameters.urlParams)r+="&"+o+"="+GM.Form.parameters.urlParams[o];window.location=r.replace(/&/,"?")+"&taskKey="+GM.Form.formScope.taskInfo.taskKey}else GM.Infomation.show(a,{type:"warning"})},function(e){GM.Infomation.show(e.message,{type:"warning"})})})},_startProcess:function _startProcess(autoHandOver,notTurnToFirst){var _this=this,ctrlCaseTitle=$("[data-role='bizname']");if(ctrlCaseTitle&&0!==ctrlCaseTitle.length)if(ctrlCaseTitle=ctrlCaseTitle.val(),ctrlCaseTitle&&""!=ctrlCaseTitle){var param={appId:GM.Form.parameters.appId,userId:GM.Form.parameters.userInfo.loginName,processDefId:GM.Form.parameters.urlParams.processDefId,title:ctrlCaseTitle};GM.Form.formScope.taskInfo.draftBizKey&&(param.draftKey=GM.Form.formScope.taskInfo.draftBizKey);var ctrlExtraBizDatas=angular.element("[data-role='biz-data']"),extraBizData;if(ctrlExtraBizDatas.length>0)for(var y=0;y<ctrlExtraBizDatas.length;y++){var sModel=$(ctrlExtraBizDatas[y].attr("ng-model"));if(sModel){var arr=sModel.split(".");arr.length>0&&(extraBizData||(extraBizData={}),extraBizData[arr[arr.length-1]]=eval("GM.Form.formScope."+sModel))}}extraBizData&&(param.extraBizData=extraBizData),GM.Form.restful.get(FORM_REST_URL.workflow.startProcess,param).then(function(e){if(!0===e.success&&(GM.Form.parameters.urlParams.ywh=e.data.bizKey,GM.Form.formScope.taskInfo.taskKey=e.data.currentTaskId,GM.Form.formScope.taskInfo.bizKey=e.data.bizKey,GM.Form.formScope.taskInfo.bizName=e.data.caseTitle,GM.Form.formScope.taskInfo.startTime=e.data.startTime,GM.Form.formScope.taskInfo.isClaimed=!0,!0===autoHandOver?GM.Form.formScope.saveAndHandOver():GM.Form.formScope.save(),_this.saveBizFlowInfo("",e.data.bizKey),!notTurnToFirst)){var r="";for(var o in GM.Form.parameters.urlParams)r+="&"+o+"="+GM.Form.parameters.urlParams[o];window.location=r.replace(/&/,"?")+"&taskKey="+GM.Form.formScope.taskInfo.taskKey}},function(e){})}else GM.Form.CommonOper.showFailureMsg("案卷标题不能为空！");else GM.Form.CommonOper.showFailureMsg("缺少用于案卷标题的控件！")},_initBizFlowDetails:function(){var e=this;GM.Form.formScope.pendingPageLz={currentPage:1},GM.Form.formScope.$watch("pendingPageLz.currentPage",function(){GM.Form.formScope.pendingPageLz.currentPage>0&&e._getLzData()}),GM.Form.formScope.lzGridOptions={};GM.Form.formScope.lzGridOptions.columnDefs=[{name:"taskKey",displayName:"当前环节",enableColumnMenu:!1,cellTooltip:!0},{name:"assigneeName",displayName:"办理人员",enableColumnMenu:!1,cellTooltip:!0},{name:"previousTaskKey",displayName:"前一环节",enableColumnMenu:!1,cellTooltip:!0},{name:"submitterName",displayName:"发件人员",enableColumnMenu:!1,cellTooltip:!0},{name:"startTime",displayName:"接收时间",enableColumnMenu:!1,cellTooltip:!0},{name:"completeTime",displayName:"转送时间",enableColumnMenu:!1,cellTooltip:!0},{name:"yj",displayName:"预警",enableColumnMenu:!1,cellTemplate:'<span style="display:block;padding:5px;color:#3280fc">正常</span>'}],GM.Form.formScope.showLzDialog=function(){Dialog=GM.Form.ngDialog.open({template:STATIC_RESOURCES_PATH+"/dist/core-views/model/liuzhuan-modal.html",scope:GM.Form.formScope,className:"ngdialog-theme-default custom"}),e._getLzData()},GM.Form.formScope.viewMap=function(){var e=GM.Form.formScope.result.zrzyjbxx.ZRZYDJDYH,r=GM.LayoutOper.addURLParam(ONEMAP_PATH,"ProjectType","zrzy");r=GM.LayoutOper.addURLParam(r,"ZRZYDJDYH",e),GM.FullModal.show("地图",r)},GM.Form.formScope.closeDialog=function(){Dialog.close()}},_getLzData:function(){var e=window.FORM_REST_URL.workflow.getTaskTrackPage+"?current="+GM.Form.formScope.pendingPageLz.currentPage+"&orderField=START_TIME&bizKey="+GM.Form.formScope.taskInfo.bizKey;GM.Form.restful.get(e,function(e){if(!0===e.success){var r=e.data.records;angular.forEach(r,function(e,r){e.index=r+1,e.startTime=GM.Form.filter("date")(e.startTime,"yyyy-MM-dd HH:mm:ss"),e.completeTime=GM.Form.filter("date")(e.completeTime,"yyyy-MM-dd HH:mm:ss")}),GM.Form.formScope.pendingPageLz.totalItems=e.data.total,GM.Form.formScope.lzGridOptions.data=e.data.records}},function(e){})},_isTaskClaimed:function(){var e=FORM_REST_URL.workflow.isClaimed+"?bizKey="+GM.Form.formScope.taskInfo.bizKey+"&taskkey="+encodeURIComponent(GM.Form.formScope.taskInfo.taskKey);GM.Form.restful.get(e,null).then(function(e){var r=!0===e.success&&!0===e.data;GM.Form.formScope.taskInfo.isClaimed=!0===e.success&&!0===e.data,r||(GM.Form.formScope.readonly=!0)},function(e){})},saveBizFlowInfo:function(e,r){GM.Form.restful.get(GM.Form.parameters.servers.updateBizFlowInfoServer+"?bizKey="+r+"&id="+e).then(function(e){},function(e){})}},window.workflowCore={}},"./src/form/core/config.js":function(e,r,o){"use strict";window.FORM_SERVER_URLS={},window.FORM_REST_URL={form:{getHandOverVarServer:"getHandOverVariables",getDataServer:"getData",saveDataServer:"saveData",getSingleDataGridServer:"getSingleDataGrid",updateBizFlowInfoServer:"updateBizFlowInfo"},workflow:{isClaimed:ACTIVITI_SERVER+"/usertask/isTaskClaimed",claimTask:ACTIVITI_SERVER+"/usertask/claimTask",unclaimTask:ACTIVITI_SERVER+"/usertask/unclaimTask",getHighLightTask:ACTIVITI_SERVER+"/usertask/getHighLightTask",startProcess:ACTIVITI_SERVER+"/usertask/startProcess",saveDataAsDraft:ACTIVITI_SERVER+"/usertask/saveDataAsDraft",getDraftData:ACTIVITI_SERVER+"/usertask/getDraftData",saveDraftInfo:ACTIVITI_SERVER+"/tdzz/saveDraftInfo",getDrafts:ACTIVITI_SERVER+"/tdzz/getDrafts",getRegionTree:ACTIVITI_SERVER+"/work/getRegionTree",getBizInfo:ACTIVITI_SERVER+"/usertask/getProcessInstance",getHandOverTarget:ACTIVITI_SERVER+"/usertask/getNextTasks",handOver:ACTIVITI_SERVER+"/usertask/handOver",getUUID:ACTIVITI_SERVER+"/usertask/getUUID",print:ACTIVITI_SERVER+"/bizconfig/print",getRedisString:ACTIVITI_SERVER+"/userdraft/getRedisString",removeRedisString:ACTIVITI_SERVER+"/userdraft/removeRedisString",redisString:ACTIVITI_SERVER+"/userdraft/redisString",getTaskTrackPage:ACTIVITI_SERVER+"/usertask/getTaskTrackPage",getDataGridDataSourceNames:ACTIVITI_SERVER+"/form/getDataGridDataSourceNames",getFormInfoById:ACTIVITI_SERVER+"/form/getFormInfoById",getProcessInstanceByBizKey:ACTIVITI_SERVER+"/usertask/getProcessInstanceByBizKey",getAnalyzedParam:ACTIVITI_SERVER+"/form/getAnalyzedParam",printConfigUrl:ACTIVITI_SERVER+"/printcfg/getByappId",getTaskConfig:ACTIVITI_SERVER+"/bizconfig/getTaskConfig"}}},"./src/form/core/controllers/file-controller.js":function(e,r,o){"use strict";o("./src/form/core/services/file-service.js"),angular.module("frameApp").controller("fileCtrl",["$scope","$location","$fileService","$captureService","ngDialog","$validation",function(e,r,o,a,t,s){var n=formBase.getUrlParamters(r.absUrl()),i=n.ywh,c=n.blbz;e.fileTreeConfig={activeNode:"activeNode",name:"filename"},e.activeNode=function(r){null!=r&&(null!=r.processDefId?e.activeFolder=!0:e.activeFolder=!1),e.pActiveNode=r},e.uploadFile=function(){$("#file_upload").click(),$("#file_upload").unbind().change(function(){var r=new FormData;r.append("multipartFile",this.files[0]),r.append("id",e.pActiveNode.id),r.append("dir",i+"\\"+e.pActiveNode.filename),r.append("isDraft",n.duuid||n.did?"1":"0");var a=GM.CommonOper.ajaxRequest(RESTURL.file.uploadFile,r,{type:"POST",cache:!1,processData:!1,contentType:!1});if(null==e.pActiveNode.children&&(e.pActiveNode.children=[]),null!=a.data&&null!=a.data.children&&0!=a.data.children.length){var t=a.data.children[0];t.filename=t.name,e.pActiveNode.children.push(t),e.$apply(e.pActiveNode),GM.Infomation.show("上传成功！")}$("#file_upload").val(""),e.fileTree=o.formatTreeData(e.fileTree,c,!0)})},e.editFolder=function(){e.copyFocusItem=angular.copy(e.pActiveNode)},e.deleteFolder=function(){GM.Alert.show("提示？","是否确认删除材料？",{showCancelButton:!0},function(){o.removeFolder(e.pActiveNode.id).then(function(r){GM.CommonOper.removeItemFromArray(e.fileTree,e.pActiveNode,"id"),GM.Infomation.show("删除成功！")},function(e){GM.Infomation.show("删除失败！"),$log.error(e)})})},e.deleteFile=function(){GM.Alert.show("提示？","是否确认删除文件？",{showCancelButton:!0},function(){o.removeFile(e.pActiveNode.id,e.pActiveNode.fileId).then(function(r){GM.TreeOper.removeNode(e.fileTree,e.pActiveNode),GM.Infomation.show("删除成功！")},function(e){GM.Infomation.show("删除失败！"),$log.error(e)})})},e.editFile=function(){e.copyFocusItem=angular.copy(e.pActiveNode)},e.viewFile=function(){var r=e.pActiveNode.url;"img"===GM.FilePath.getFileType(r)?e.imgUrl=r:window.open(r)},e.saveFile=function(){angular.copy(e.pActiveNode,e.copyFocusItem),o.saveFile(e.copyFocusItem).then(function(r){angular.copy(e.copyFocusItem,e.pActiveNode),GM.Infomation.show("修改成功！"),$("#fileModal").modal("hide")},function(e){GM.Infomation.show("修改失败！"),$log.error(e)})},e.addFolder=function(){GM.Form.Dialog=t.open({template:"folderModal.html",scope:e})},e.closeDialog=function(){t&&t.close()},e.saveFolder=function(r){GM.LayoutOper.validateForm(s,r.folderForm,function(){o.saveFolder(e.copyFocusItem).then(function(r){null==e.copyFocusItem.id?(e.fileTree.push(r.data),GM.Infomation.show("添加成功！")):(angular.copy(e.copyFocusItem,e.pActiveNode),GM.Infomation.show("修改成功！")),t.close()},function(r){null==e.focusItem?GM.Infomation.show("添加失败！"):GM.Infomation.show("修改失败！"),$log.error(r)})},function(){})},e.captureImg=function(){a.showCapture(e)}}])},"./src/form/core/controllers/form-controller.js":function(e,r,o){"use strict";o("./src/form/core/services/form-core-service.js"),o("./src/form/core/base/api.js"),o("./src/form/core/directives/tab-components.js"),o("./src/form/core/filters/workflow-filter.js"),angular.module("frameApp").controller("indexCtrl",["$scope","$http","$gmRestful",function(e,r,o){GM.token=top.GM.token;var a=new o;GM.FrameManager.prepareData(e,a);var t=GM.LayoutOper.getParamsValue(window.location.href,"ywh"),s=GM.LayoutOper.getParamsValue(window.location.href,"taskKey"),n=GM.LayoutOper.getParamsValue(window.location.href,"processKey"),i=GM.LayoutOper.getParamsValue(window.location.href,"processDefId"),c=function(){var r=GM.LayoutOper.getParamsValue(window.location.href,"view");e.subUrl=r?"views/"+r+".html?"+window.location.href.split("?")[1]:STATIC_RESOURCES_PATH+"dist/core-views/layout/formIndex.html"};if(t&&!n){var m=window.FORM_REST_URL.workflow.getProcessInstanceByBizKey+"?bizKey="+encodeURIComponent(t),l=GM.LayoutOper.getParamsValue(window.location.href,"box");s||(s="查看"),GM.Form.CommonOper.syncAjaxGet(m,function(e){if(e&&!0===e.success&&e.data){var r=e.data;r.processDef&&r.processDef.processDefinitionId&&(n=r.processDef.processDefinitionId.split(":")[0],m="index.html?appId="+GM.AppInfo.id+"&serviceAppKey="+r.processDef.serviceAppKey+"&box="+l+"&ywh="+t+"&processKey="+n+"&processDefId="+r.processDefId+"&taskKey="+encodeURIComponent(s)+"&processName="+encodeURIComponent(r.processDef.processName)+"&caseTitle="+encodeURIComponent(r.caseTitle),"查看"===s&&(m+="&forbid=1"),window.location=m)}},function(e){document.write("无法获取业务详情。")})}else{var f=window.FORM_REST_URL.workflow.getTaskConfig+"?processDefId="+i+"&taskKey=";f+=encodeURIComponent(s||"起草"),GM.Form.CommonOper.syncAjaxGet(f,function(o){!0===o.success&&o.data?function(o){var a="";if(o.forms&&o.forms.length>0){for(var t=[],s=0;s<o.forms.length;s++)t.push(o.forms[s].formid);a=t.join(",")}e.formIds=a,a?r.get(window.FORM_REST_URL.workflow.getDataGridDataSourceNames+"?formids="+a).then(function(e){!0===e.data.success&&(GM.Form.parameters.formDataSourceNames=e.data.data),c()},function(e){console.log(e)}):(GM.LayoutOper.getParamsValue(window.location.href,"view"),c())}(o.data):document.write("请求数据失败。")},function(e){document.write("请求数据失败。")})}e.closeDlg=function(){$("button.close[data-dismiss]",window.parent.document).click()}}]),angular.module("frameApp").controller("formCtrl",["$scope","$timeout","$formCoreService","$filter","ngDialog","$validation","$gmTable",function(e,r,o,a,t,s,n){e.$on("$includeContentLoaded",function(e,r){var o=GM.LayoutOper.getURLParams(r);e.targetScope.readonly="true"===o.readonly}),o.loadPage(e,s,a,t,n,r)}]),angular.module("frameApp").controller("initCtrl",["$scope",function(e){console.log("initCtrl")}])},"./src/form/core/controllers/handover-controller.js":function(e,r,o){"use strict";o("./src/form/core/services/handover-service.js"),angular.module("frameApp").controller("handOverCtrl",["$scope","$handOverService",function(e,r){r.loadPage(e)}])},"./src/form/core/directives/tab-components.js":function(e,r,o){"use strict";angular.module("frameApp").directive("tabTop",function(){return{restrict:"EAC",template:'<div class="form-top-div clearfix"><div class="form-top-left pull-left"><div ng-if="!taskInfo.forbid"><h3>项目类型：{{taskInfo.processName}}&nbsp;&nbsp;&nbsp;当前节点：{{taskInfo.taskKey}}</h3>流程状态：<span class="label"ng-if="!taskInfo.isClaimed">未签收</span><span class="label label-success"ng-if="taskInfo.isClaimed">已签收</span></div><div ng-if="taskInfo.forbid"><h3>项目类型：{{taskInfo.processName}}</div></div><div class="form-top-right pull-right"ng-init="operatList = true"ng-init="print = true"><div class="dropdown"><i class="icon icon-list-ul more"data-toggle="dropdown"title="菜单"></i><ul class="dropdown-menu pull-right"><li class="dropdown"ng-if="!taskInfo.forbid && !taskInfo.isClaimed"ng-click="claim(true);"><a href="javascript:;">签收</a></li><li class="dropdown"ng-if="!taskInfo.forbid && taskInfo.isClaimed"ng-click="claim(false)"><a href="javascript:;">放弃</a></li><li class="divider"></li><li class="dropdown-submenu"ng-click="showWfGraph()"><a href="javascript:;">流程图</a></li><li class="divider"></li><li class="dropdown"><a href="javascript:;">打印</a><ul class="dropdown-menu pull-left"><li ng-repeat="item in printItems"><a href="javascript:;"ng-click="print(item.code)">{{item.name}}</a></li></ul></li><li class="divider"></li><li class="dropdown"ng-click="viewMap()"><a href="javascript:;">定位</a></li></ul></div></div></div><hr style="margin-top: 0">',link:function(e,r,o,a){}}})},"./src/form/core/filters/workflow-filter.js":function(e,r,o){"use strict"},"./src/form/core/services/file-service.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$fileService",["$gmRestful",function(e){return{getDraftAttaches:function(r,o,a,t){return(new e).get(RESTURL.file.getDraftAttaches,{draftBizKey:r,processKey:o,taskKey:a,subType:t})},getAttachesFromRedis:function(r,o,a,t){return(new e).get(RESTURL.file.getAttachesFromRedis,{draftBizKey:r,processKey:o,taskKey:a,subType:t})},queryTree:function(r,o,a){return(new e).get(RESTURL.file.queryTree,{ywh:r,zlx:o,sxh:a})},saveFolder:function(r){return(new e).post(RESTURL.file.saveFolder,{},r)},removeFolder:function(r){return(new e).post(RESTURL.file.deleteFolder,{},{id:r})},removeFile:function(r,o){return(new e).post(RESTURL.file.deleteFile,{},{id:r,fileId:o,status:1})},saveFile:function(r){return(new e).post(RESTURL.file.saveFile,{},r)},formatTreeData:function(e,r,o){if(null!=e){for(var a=GM.TreeOper.getAllNodes(e),t=0;t<a.length;t++){var s=a[t];if(s.processDefId)if(s.parent=!0,!1===this._isFileEnable(s,r,o)){if(s.nodeType="disabled",null!=s.children&&s.children.length>0)for(var n=0;n<s.children.length;n++){s.children[n].nodeType=s.nodeType}}else!0!==this._isFileNecessary(s)||null!=s.children&&0!==s.children.length?s.nodeType="default":s.nodeType="error";else s.filename=s.name}return e}},initTree:function(e,r,o,a,t,s){var n=this,i=a||"",c=t||"";s.duuid?n.getDraftAttaches(r,s.processid,o,i).then(function(r){var o=n.formatTreeData(r.data,s.blbz,!0);e.fileTree=o}):s.did?n.getAttachesFromRedis(r,s.processid,o,i).then(function(r){var o=n.formatTreeData(r.data,s.blbz,!0);e.fileTree=o}):n.queryTree(r,i,c).then(function(r){var o=n.formatTreeData(r.data,s.blbz,!0);e.fileTree=o})},_isFileEnable:function(e,r,o){return 0!=o},_isFileNecessary:function(e){return!0}}}]),angular.module("frameApp").factory("$captureService",["$gmRestful",function(e){var r=new e,o=function(){var e=$(window).height(),r=650;r>e&&(r=e);var o=(r-115)/.75+35+300;$(".oa-capture-dialog").dialog({title:"材料扫描",modal:!0,width:o,height:r})};return GM.DotNetCapture={showDialog:function(e){this.$scope=e,this.$scope.tableData=[],this.options={camera:0,resolution:0},this._innitLayout(),this._initEvent(),o()},_innitLayout:function(){this._modifyLayout(),null==this.device_camera&&(this.device_camera=$("#CaptureView")[0]),this.device_camera.CameraStop(),this.device_camera.Init();var e=this.device_camera.getDeviceNames();if(e){for(var r=e.split(";"),o=0;o<r.length;o++)GM.CommonOper.isStrNullOrEmpty(r[o])&&(GM.CommonOper.removeItemFromArray(r,r[o]),o--);this.$scope.arrayCameras=r}this.device_camera.CameraConn(this.options.camera,this.options.resolution),this.$scope.selectCamera=String(this.options.camera),this.$scope.arrayResolutions=this._getResolutions(),this.$scope.selectResolution=String(this.options.resolution)},_modifyLayout:function(){$("#CaptureView").remove(),$(".oa-capture-view").append('<OBJECT ID="CaptureView" CLASSID="CLSID:A14B31B4-C560-4DF7-A30C-59A3AE8C598D" style="height:100%;width:100%"></OBJECT>'),"CLSID:A14B31B4-C560-4DF7-A30C-59A3AE8C598D"!==$("#CaptureView").attr("CLASSID")&&($("#CaptureView").remove(),$(".oa-capture-view").append('<OBJECT ID="CaptureView" CLASSID="CLSID:A14B31B4-C560-4DF7-A30C-59A3AE8C598D" style="height:100%;width:100%"></OBJECT>'))},_initEvent:function(){var e=this;this.$scope.chooseCamera=function(r){var o=Number(e.$scope.selectCamera);Number(e.$scope.selectResolution);e.device_camera.CameraConn(o,0),e.$scope.arrayResolutions=e._getResolutions(),e.$scope.selectResolution="0"},this.$scope.chooseResolution=function(r){var o=Number(e.$scope.selectCamera),a=Number(e.$scope.selectResolution);e.device_camera.CameraConn(o,a)},this.$scope.updateCamera=function(){e.updateDevice()},this.$scope.shoot=function(){var r=e.device_camera.MakeCapture();r&&e.$scope.tableData.push({name:e.$scope.tableData.length+1,strBase64:r,uploadStatus:"待上传"}),e.updateDevice()},this.$scope.reshoot=function(){e.$scope.view="camera"},this.$scope.viewImg=function(r){e.$scope.view="img",e.$scope.imgBase64=r.strBase64},this.$scope.deleteItem=function(r){GM.CommonOper.removeItemFromArray(e.$scope.tableData,r)},this.$scope.uploadFile=function(){for(var o=0;o<e.$scope.tableData.length;o++){var a=e.$scope.tableData[o];if("待上传"===a.uploadStatus){var t=r.ajax(RESTURL.file.uploadBase64,a);if(t&&!0===t.success){a.uploadStatus,null==e.$scope.pActiveNode.children&&(e.$scope.pActiveNode.children=[]);var s=t.data;e.$scope.pActiveNode.children.push(s)}}}},$(".oa-capture-dialog").on("dialogbeforeclose",function(){e.destory()}),$(window).unbind("beforeunload",GM.DotNetCapture.destory).bind("beforeunload",GM.DotNetCapture.destory)},_getResolutions:function(){var e=this.device_camera.getVideoResolutions();return e?e.split(";"):null},updateDevice:function(){this.destory(),null==this.device_camera&&(this.device_camera=$("#CaptureView")[0]),this.device_camera.CameraStop(),this.device_camera.Init();var e=Number(this.$scope.selectCamera),r=Number(this.$scope.selectResolution);this.device_camera.CameraConn(e,r)},destory:function(){GM.DotNetCapture.device_camera&&(GM.DotNetCapture.device_camera.CameraStop(),GM.DotNetCapture.device_camera=null)}},{showCapture:function(e){switch(e.capture={},this.getVertion()){case"LiangTian":case"FangZheng":case"JieYuA16D":case"JieYuJYP6008T":break;default:GM.DotNetCapture.showDialog(e)}},getVertion:function(){return""}}}])},"./src/form/core/services/form-core-service.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$formCoreService",["$gmRestful",function(e){return{loadPage:function(r,o,a,t,s,n){GM.Form.FormEngine.init(r,new e,o,a,t,s,n),GM.Form.FormData.init(r.formIds),r.getData()}}}])},"./src/form/core/services/handover-service.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$handOverService",["$gmRestful",function(e){return{loadPage:function(e){var r=this;e.taskInfo&&e.taskInfo.hasOwnProperty("taskKey")&&e.taskInfo.taskKey?(e.result={},e.nextNodes=[],e.handOverConfig={name:"name",children:"childrens",checkNode:"checkItem"},r._bindEvents(e),r._getHandOverChecks(e.taskInfo.processDefId,e.taskInfo.taskKey,e.taskInfo.bizKey).then(function(o){!0===o.success&&(e.handOverVar=o.data,r._getHandOverTarget(e.taskInfo.processDefId,e.taskInfo.taskKey,o.data).then(function(r){if(!0===r.success&&r.data&&null!=r.data){e.nextNodes=r.data,e.isOnlyLastNode=1===r.data.length&&"__结束__"==r.data[0].node;for(var o=[],a=angular.copy(r.data),t=0;t<a.length;t++)if(o[t]={name:a[t].node,childrens:a[t].groups},a[t].groups)for(var s=0;s<a[t].groups.length;s++)o[t].childrens[s]={name:a[t].groups[s].name,id:a[t].groups[s].id,childrens:a[t].groups[s].users};e.chooseRole=o}else r.message&&GM.Form.CommonOper.showFailureMsg(r.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)}))},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})):GM.Form.CommonOper.showFailureMsg("无法获取移交相关参数！")},_bindEvents:function(e){var r=this;e.checkItem=function(o){r._checkItem(e,o)},e.modelHandOver=function(){r._doHandOver(e)},e.unselectUser=function(o,a,t){r._unselect(e,o,a,t)}},_checkItem:function(e,r){if(e.selectedUsers=[],r instanceof Array)for(var o=0;o<r.length;o++)"3"==r[o].flag&&this._selectUser(e,r[o].node,r[o].id,r[o].name);else r&&"3"==r.flag&&this._selectUser(e,r.node,r.id,r.name)},_selectUser:function(e,r,o,a){for(var t={id:o,name:a},s=!1,n=0;n<e.selectedUsers.length;n++)if(e.selectedUsers[n].node&&e.selectedUsers[n].node==r){if(!GM.CommonOper.isArrayContainsEle(e.selectedUsers[n].users,t)){var i=e.selectedUsers[n].users||[];i.push(t),e.selectedUsers[n].users=i}s=!0;break}s||e.selectedUsers.push({node:r,users:[t]})},_unselect:function(e,r,o,a){this._uncheckTreeUser(e,r,o,a);for(var t=0;t<e.selectedUsers.length;t++)if(e.selectedUsers[t].node&&e.selectedUsers[t].node==r){var s=e.selectedUsers[t].users,n={id:o,name:a};GM.CommonOper.removeItemFromArray(s,n,"id"),0===s.length?e.selectedUsers.splice(t,1):e.selectedUsers[t].users=s}},_uncheckUserOnTree:function(e,r,o,a){if(e.childrens&&e.childrens.length>0)for(var t=0;t<e.childrens.length;t++)this._uncheckUserOnTree(e.childrens[t],r,o,a);else"3"==e.flag&&e.id==o&&e.node==r&&(e.check=!1)},_uncheckTreeUser:function(e,r,o,a){for(var t=0;t<e.chooseRole.length;t++)this._uncheckUserOnTree(e.chooseRole[t],r,o,a)},_doHandOver:function(e){if(e.isOnlyLastNode&&!0===e.isOnlyLastNode||e.selectedUsers&&0!==e.selectedUsers.length){var r=this,o={userId:top.GM.userInfo.loginName,bizKey:e.taskInfo.bizKey,taskKey:e.taskInfo.taskKey,variables:e.handOverVar};if(!0!==e.isOnlyLastNode){for(var a={target:[]},t=null,s=0;s<e.selectedUsers.length;s++)t=GM.Form.CommonOper.mapFieldArray(e.selectedUsers[s].users,"id"),a.target.push({node:e.selectedUsers[s].node,users:t});o.targets=JSON.stringify(a)}this._handOver(o).then(function(o){if(!0===o.success){o.data&&r._saveBizFlowInfo(o.data,e.taskInfo.bizKey);var a=!0===e.isOnlyLastNode?"流程已结束！":"移交成功！";GM.Form.CommonOper.showSuccessMsg(a),GM.Form.formScope.closeDialog();var t=e.handOverParam&&e.handOverParam.boxName;top.goPendingPage(t)}else GM.Form.CommonOper.showFailureMsg(o.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})}else GM.Form.CommonOper.showFailureMsg("请先选择移交对象！")},_getBizInfo:function(r,o,a){return e().get(FORM_REST_URL.workflow.getBizInfo,{userId:r,bizKey:o,taskKey:a})},_getHandOverChecks:function(r,o,a){return e().get(GM.Form.parameters.servers.getHandOverVarServer,{processDefId:r,taskKey:o,bizKey:a})},_getHandOverTarget:function(r,o,a){return e().get(FORM_REST_URL.workflow.getHandOverTarget,{processDefId:r,taskKey:o,var:JSON.stringify(a)})},_handOver:function(r){return e().post(FORM_REST_URL.workflow.handOver,r)},_saveBizFlowInfo:function(e,r){GM.Form.CommonOper.syncAjaxGet(GM.Form.parameters.servers.updateBizFlowInfoServer+"?bizKey="+r,function(e){},function(e){})}}}])},"./src/form/core/views/model/dialog.html":function(e,r){e.exports='<header class=dialog-header> <h4 class=modal-title>{{dialogParameter.title}}</h4> </header> <div class=dialog-content> <div class=dialog-query-content> <form class="form-simple form-horizontal"> <div ng-include=dialogParameter.url></div> </form> </div> </div> <div class=dialog-buttons> <button ng-repeat="button in dialogParameter.buttons" class="btn btn-default" ng-click=dialogButtonClick(button.click)>{{button.name}}</button> <button type=button class="btn btn-default" ng-click=closeDialog()>关闭</button> </div>'},"./src/form/form.js":function(e,r,o){"use strict";o("./src/form/app.js"),o("./src/form/core/config.js"),o("./src/form/core/base/form-engine.js"),o("./src/form/core/controllers/file-controller.js"),o("./src/form/core/controllers/form-controller.js"),o("./src/form/core/controllers/handover-controller.js"),o("./src/form/office/controllers/agency-ctrl.js"),o("./src/form/office/controllers/complete-ctrl.js"),o("./src/form/office/controllers/draft-ctrl.js"),o("./src/form/office/controllers/protocol-ctrl.js")},"./src/form/office/controllers/agency-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/agency-services.js"),angular.module("frameApp").controller("agencyCtrl",["$scope","$rootScope","$agencyService","$filter",function(e,r,o,a){var t=GM.userInfo.loginName,s=GM.AppInfo.id;function n(){o.queryPendingData(e.agencyForm).then(function(r){var o=r.data.records;angular.forEach(o,function(e,r){e.index=r+1,e.startTime=a("date")(e.startTime,"yyyy-MM-dd HH:mm:ss")}),e.userData.data.page.records=o,e.pendingPage.totalItems=r.data.total},function(e){GM.Infomation.show(e.message,{type:"warning"})})}e.pendingPage={},e.agencyForm={userId:t,appId:s,orderField:"startTime"},e.$watch("pendingPage.currentPage",function(){e.pendingPage.currentPage>0&&(e.agencyForm.current=e.pendingPage.currentPage,n())}),e.pendingPage.currentPage=1,e.tagData={tags:[{name:"计划待办",value:"计划待办"},{name:"实施待办",value:"实施待办"},{name:"验收待办",value:"验收待办"}],checkTag:"checkTag"},e.checkTag=function(r){e.agencyForm.xmjd=[];for(var o=0;o<r.length;o++)e.agencyForm.xmjd.push(r[o].value);n()},e.userData={config:{taskKey:{type:"a",click:"goProcess"}},data:{page:{},head:{index:"序号",bizKey:"案卷编号",bizName:"案卷名称",processName:"项目类型",startTime:"提交时间",submitterName:"提交人",taskKey:"当前环节"}},headList:["index","bizKey","bizName","processName","startTime","submitterName","taskKey"]};e.refer=function(){n()},e.delet=function(){e.agencyForm={userId:t},n()},e.goProcess=function(e){console.log(e),r.processUrl=o.getHtmlPath()+"?appId="+s+"&serviceAppKey="+e.serviceAppKey+"&box=agency&ywh="+e.bizKey+"&processKey="+e.processKey+"&processDefId="+e.processDefId+"&taskKey="+encodeURIComponent(e.taskKey?e.taskKey:"起草")+"&processName="+encodeURIComponent(e.processName)+"&caseTitle="+encodeURIComponent(e.bizName),$("[ng-controller='agencyCtrl'] *").hide(),$("[ng-controller='agencyCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="agencyCtrl"></iframe>'),window.agencyCtrl.location.href=r.processUrl},e.goPending=function(){e.activeNaviFromPath("/agency",!0)}}])},"./src/form/office/controllers/complete-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/agency-services.js"),angular.module("frameApp").controller("completeCtrl",["$scope","$rootScope","$agencyService","$filter",function(e,r,o,a){var t=GM.userInfo.loginName,s=GM.AppInfo.id;function n(){o.queryCompleteData(e.completeForm).then(function(r){var o=r.data.records;angular.forEach(o,function(e,r){e.index=r+1,e.completeTime=a("date")(e.completeTime,"yyyy-MM-dd")}),e.userData.data.page.records=o,e.pendingPage.totalItems=r.data.total},function(e){GM.Infomation.show(e.message,{type:"warning"})})}e.completeForm={userId:t,appId:s,orderField:"completeTime"},e.pendingPage={currentPage:1},e.$watch("pendingPage.currentPage",function(){e.pendingPage.currentPage>0&&(e.completeForm.current=e.pendingPage.currentPage,n())}),e.pendingPage.currentPage=1,e.tagData={tags:[{name:"计划阶段",value:0},{name:"实施阶段",value:1},{name:"验收阶段",value:2}],checkTag:"checkTag"},e.checkTag=function(r){e.completeForm.xmjd=[];for(var o=0;o<r.length;o++)e.completeForm.xmjd.push(r[o].name);n()},e.userData={config:{operate:[{name:"查看",icon:"icon-edit",click:"goProcess"}]},data:{page:{},head:{index:"序号",bizKey:"案卷编号",bizName:"案卷名称",processName:"项目类型",taskKey:"已办环节",completeTime:"提交时间",targetTaskKey:"接收环节",receiverName:"接收人"}},headList:["index","bizKey","bizName","processName","taskKey","completeTime","targetTaskKey","receiverName"]},e.refer=function(){n()},e.delet=function(){e.completeForm={userId:t},n()},e.goProcess=function(e){console.log(e),r.processUrl="forms/index.html?appId="+s+"&serviceAppKey="+e.serviceAppKey+"&box=complete&ywh="+e.bizKey+"&processKey="+e.processKey+"&processDefId="+e.processDefId+"&taskKey="+encodeURIComponent("查看")+"&processName="+encodeURIComponent(e.processName)+"&caseTitle="+encodeURIComponent(e.bizName),$("[ng-controller='completeCtrl'] *").hide(),$("[ng-controller='completeCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="completeCtrl"></iframe>'),window.completeCtrl.location.href=r.processUrl},e.goPending=function(){e.activeNaviFromPath("/complete",!0)}}])},"./src/form/office/controllers/draft-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/draft-services.js"),angular.module("frameApp").controller("draftCtrl",["$scope","$location","$rootScope","$draftService","$agencyService","$log",function(e,r,o,a,t,s){var n=GM.userInfo.loginName;function i(){t.queryDraftData(e.draftForm).then(function(r){var o=r.data.page.records;angular.forEach(o,function(e,r){e.index=r+1}),e.userData.data.page.records=o,e.pendingPage.totalItems=r.data.page.total},function(e){GM.Infomation.show(e.message,{type:"warning"})})}e.draftForm={userId:n},e.regions=GM.userInfo.areas,e.treearea={name:"title",children:"childrens",attvalue:"code"},e.pendingPage={currentPage:1},e.$watch("pendingPage.currentPage",function(){e.pendingPage.currentPage>0&&(e.draftForm.current=e.pendingPage.currentPage,i())}),e.pendingPage.currentPage=1,e.tagData={tags:[{name:"一般开发项目",value:"一般开发项目"},{name:"专项基金开发项目",value:"专项基金开发项目"},{name:"一般整理项目",value:"一般整理项目"},{name:"国土部门高标准项目",value:"国土部门高标准项目"},{name:"其它部门高标准项目",value:"其它部门高标准项目"},{name:"一般复垦项目",value:"一般复垦项目"},{name:"采空区复垦",value:"采空区复垦"},{name:"矿业用地存量复垦",value:"矿业用地存量复垦"}],checkTag:"checkTag"},e.checkTag=function(r){e.draftForm.xmjd=[];for(var o=0;o<r.length;o++)e.draftForm.xmjd.push(r[o].value);i()},e.userData={config:{operate:[{name:"编辑",icon:"icon-edit",click:"goProcess"}]},data:{page:{},head:{index:"序号",xmysubh:"预算编号",xmmc:"项目名称",xzqmc:"项目位置",zgm:"总规模",ztz:"总投资",xmjd:"项目阶段",xmlx:"项目类型"}},headList:["index","xmysubh","xmmc","xzqmc","zgm","ztz","xmjd","xmlx"]},e.refer=function(){i()},e.delet=function(){e.draftForm={userId:n},i()},e.goPending=function(){e.activeNaviFromPath("/draft",!0)},e.goProcess=function(e){o.processUrl=t.getHtmlPath()+"?did="+e.id+"&box=draft&processid="+encodeURIComponent(e.processKey),$("[ng-controller='draftCtrl'] *").hide(),$("[ng-controller='draftCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="draftCtrl"></iframe>'),window.draftCtrl.location.href=o.processUrl}}])},"./src/form/office/controllers/protocol-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/protocol-services.js"),angular.module("frameApp").controller("protocolCtrl",["$scope","$rootScope","$protocolService","$agencyService","$log",function(e,r,o,a,t){if(top.GM.userInfo&&0!==top.GM.userInfo.permissions.length){o.queryDraft(top.GM.AppInfo.id,top.GM.userInfo.permissions.join(",")).then(function(r){e.draftData=r.data},function(e){t.error(e)}),e.draftProcess=function(e){o.getUUID(null).then(function(r){r&&!0===r.success?s(e,r.data):s(e,"unknown")},function(r){s(e,"unknown")})},e.goPending=function(){e.activeNaviFromPath("/protocol",!0)};var s=function(e,o){var t=e.processDefinitionId.split(":")[0];r.processUrl=a.getHtmlPath()+"?startFlag=1&duuid="+o+"&box=protocol&appId="+top.GM.AppInfo.id+"&serviceAppKey="+e.serviceAppKey+"&processKey="+t+"&processDefId="+e.id+"&processName="+encodeURIComponent(e.processName),$("[ng-controller='protocolCtrl'] *").hide(),$("[ng-controller='protocolCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="protocolCtrl"></iframe>'),window.protocolCtrl.location.href=r.processUrl}}else GM.Infomation.show("无法获取当前用户权限！",{type:"danger",placement:"center"})}])},"./src/form/office/services/agency-services.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$agencyService",["$gmRestful",function(e){return{queryExtraBizFields:function(r){return(new e).get(ACTIVITI_SERVER+"usertask/getExtraBizFields?appId="+r)},queryStartData:function(r){return(new e).get(RESTURL.process.start,r)},queryPendingData:function(r){return(new e).get(ACTIVITI_SERVER+"usertask/list/handling",r)},getQuery:function(r){return(new e).get(RESTURL.process.query,r)},processDate:function(e){var r=new Date(e);return[r.getFullYear(),r.getMonth()+1,r.getDate()].join("-")},queryCompleteData:function(r){return(new e).get(ACTIVITI_SERVER+"usertask/list/handled",r)},queryDraftData:function(r){return(new e).get(ACTIVITI_SERVER+"userdraft/getDraftInfo",r)},getHtmlPath:function(){return"forms/index.html","forms/index.html"},getProcessCatalogs:function(r,o){return(new e).get(RESTURL.wf.getProcessCatalogs+(o?"?id="+o:""),r)},edit:function(r){return(new e).post(RESTURL.wf.editProcessCatalog,r)},delete:function(r,o){return(new e).get(RESTURL.wf.deleteProcessCatalog+"?id="+o,r)}}}])},"./src/form/office/services/draft-services.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$draftService",["$gmRestful",function(e){return{queryPendingData:function(r){return(new e).get(ACTIVITI_SERVER+"userdraft/getDraftInfo",r)}}}])},"./src/form/office/services/protocol-services.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$protocolService",["$gmRestful",function(e){return{queryDraft:function(r,o){return(new e).get(ACTIVITI_SERVER+"/bizconfig/getProcessCatalogs?appId="+r+"&permissions="+encodeURIComponent(o))},getUUID:function(){return(new e).get(ACTIVITI_SERVER+"/usertask/getUUID")}}}])}},["./src/form/form.js"]);
//# sourceMappingURL=form-44834.bundle.js.map