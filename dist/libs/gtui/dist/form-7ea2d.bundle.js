webpackJsonp(["form"],{"./src/form/core/base/api.js":function(e,r,o){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};GM.Form={},GM.Form.CommonOper={showSuccessMsg:function(e){GM.Infomation.show(e,{type:"success",placement:"center"})},showFailureMsg:function(e){GM.Infomation.show(e,{type:"danger",placement:"center"})},getUUID:function(){var e,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];for(e=0;e<32;e++)o[e]=r[0|16*Math.random()];return o.join("")},showDialog:function(e,r,o,t){var a,s,n={iframe:e+(e.indexOf("?")>-1?"&":"?")+"version="+new Date,title:r,backdrop:"static"};if(o&&o.indexOf(",")>-1){var i=o.split(",");try{a=parseInt(i[0])+"px"}catch(e){a="1000px"}try{s=parseInt(i[1])+"px"}catch(e){s="800px"}n.width=a,n.height=s}else n.size=o;new $.zui.ModalTrigger(n).show({hidden:function(){t&&t()}})},mapFieldArray:function(e,r){for(var o=[],a=0;a<e.length;a++)"object"===t(e[a])&&e[a][r]&&o.push(e[a][r]);return o},syncAjaxGet:function(e,r,o,t){this._syncAjax("GET",e,r,o,t)},syncAjaxPost:function(e,r,o,t){this._syncAjax("POST",e,r,o,t)},_syncAjax:function(e,r,o,t,a){var s={url:r,async:!1,type:e,success:function(e){o(e)},error:function(e){t(e)}};a&&(s.data=a),$.ajax(s)},getCnFormatMoney:function(e){var r=["角","分"],o=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],t=[["元","万","亿"],["","拾","佰","仟"]],a=e<0?"欠":"";e=Math.abs(e);for(var s="",n=0;n<r.length;n++)s+=(o[Math.floor(10*e*Math.pow(10,n))%10]+r[n]).replace(/零./,"");s=s||"整",e=Math.floor(e);for(n=0;n<t[0].length&&e>0;n++){for(var i="",c=0;c<t[1].length&&e>0;c++)i=o[e%10]+t[1][c]+i,e=Math.floor(e/10);s=i.replace(/(零.)*零$/,"").replace(/^$/,"零")+t[0][n]+s}return a+s.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")},setObjectAttrVal:function(e,r,o,t){var a=r.split(".");o!=a.length-1?(e=e[a[o]],o++,this.setObjectAttrVal(e,r,o,t)):e[a[o]]=t},cloneObject:function(e){if(null==e||"object"!==(void 0===e?"undefined":t(e)))return e;if(e instanceof Date)return(r=new Date).setTime(e.getTime()),r;if(e instanceof Array){for(var r=[],o=0,a=e.length;o<a;++o)r[o]=GM.Form.CommonOper.cloneObject(e[o]);return r}if(e instanceof Object){r={};for(var s in e)e.hasOwnProperty(s)&&(r[s]=GM.Form.CommonOper.cloneObject(e[s]));return r}throw new Error("Unable to copy obj! Its type isn't supported.")},showMapDialog:function(){if(null==window.frames.processMap.pMap){$("#mapViewDialog").dialog({title:"地图查看",autoOpen:!1,resizeable:!0,draggable:!0,show:{effect:"fadeIn",duration:500},hide:{effect:"fadeOut",duration:500},modal:!1,width:1200,height:500,zIndex:100,position:{my:"right bottom",at:"right bottom",of:window}});var e=parent.location,r=e.pathname;"html"===r.toLowerCase().substr(r.length-4,4)?r=GM.FilePath.getDirName(r):"/"===r.toLowerCase().substr(r.length-1,1)&&(r=r.substr(0,r.length-1)),window.frames.processMap.location.href=e.origin+r+"/map.html"}$("#mapViewDialog").dialog("open")}}},"./src/form/core/base/form-data.js":function(e,r,o){"use strict";o("./src/form/core/base/api.js"),GM.Form.FormData={init:function(e){this._initScopeVar(),this._bindEvents(e),GM.Form.formScope.gridQueryParams={queryType:void 0,queryValue:void 0},GM.Form.parameters.formDataSourceNames&&GM.Form.parameters.formDataSourceNames.length>0&&this._initOptions(GM.Form.formScope,GM.Form.parameters.formDataSourceNames)},_datas:{globe:{},saveKeys:{}},_initScopeVar:function(){GM.Form.formScope.result={}},_bindEvents:function(e){var r=this;GM.Form.formScope.getData=function(){GM.Form.parameters.urlParams.did?GM.Form.parameters.urlParams.did&&r._getDraftData(GM.Form.parameters.urlParams.did):r._getData(e)},GM.Form.formScope.save=function(e,o){r._saveData(!1,e,o)},GM.Form.formScope.saveAndHandOver=function(){r._saveData(!0)},GM.Form.formScope.saveDraft=function(){r._saveDraft(GM.Form.parameters.urlParams.duuid||GM.Form.parameters.urlParams.did)},GM.Form.formScope.getSingleDataGrid=function(e,o){r._getSingleDataGrid(GM.Form.formScope,e,o)},GM.Form.formScope.dataGridSelect=function(e){r._dataGridSelect(GM.Form.formScope,e),e.grid.appScope.closeThisDialog()},GM.Form.formScope.saveDialog=function(){r._saveDialog(),GM.Form.formScope.closeFormDialog()},GM.Form.formScope.dgA=function(e){r._dataGridOperA(GM.Form.formScope,e)},GM.Form.formScope.dgB=function(e){r._dataGridOperB(GM.Form.formScope,e)},GM.Form.formScope.getRedisString=function(e){return r._getRedisString(e)},GM.Form.formScope.removeRedisString=function(e){r._removeRedisString(e)},GM.Form.formScope.redisString=function(e,o){r._redisString(e,o)},GM.Form.formScope.initDataGridOptions=function(e){r._initDataGridOptions(GM.Form.formScope,e)},GM.Form.formScope.initDataGridHeaders=function(e,o,t){r._getGridOption(GM.Form.formScope,e,null,null,o,t)}},_initOptions:function(e,r){if(r&&0!==r.length)for(var o=0;o<r.length;o++)if(r[o]){var t,a,s=$("div[ui-grid='"+r[o]+"Option']");s.length>0&&(t=s.attr("data-items"),a=s.attr("template-items")),this._getGridOption(e,r[o],null,null,t,a)}},_initDataGridOptions:function(e,r){var o=this,t=window.FORM_REST_URL.workflow.getDataGridDataSourceNames+"?formids="+r;GM.Form.CommonOper.syncAjaxGet(t,function(r){!0===r.success&&r.data&&o._initOptions(e,r.data)},function(e){})},_getRedisString:function(e){var r;return GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.getRedisString+"?key="+e,function(e){!0===e.success&&e.data&&(r=e.data)},function(e){}),r},_removeRedisString:function(e){GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.removeRedisString+"?key="+e,function(e){},function(e){})},_redisString:function(e,r){GM.Form.CommonOper.syncAjaxPost(window.FORM_REST_URL.workflow.getRedisString+"?key="+e,function(e){},function(e){},{key:e,data:r})},_dataGridOperA:function(e,r){var o=event.srcElement;if(o){for(var t,a=$(o).text(),s=r.grid.element.attr("template-items").split(","),n=0;n<s.length;n++){var i=s[n].split(":");if(!(i.length<3)&&i[1]==a){t=i[2];break}}t&&this._showDataGridDlg(e,r,t)}},_dataGridOperB:function(e,r){var o=event.srcElement;if(o){for(var t,a,s,n,i=$(o).text(),c=r.grid.element.attr("template-items").split(","),l=0;l<c.length;l++){var m=c[l].split(":");if(!(m.length<3)&&m[1]==i){t=m[2],m[3]&&(a=m[3]),m[4]&&(s=m[4].replace(/RDS_COLON/g,":")),m[5]&&(n=m[5]);break}}if(t){var f=this;s?GM.Alert.show("提示",s,{showCancelButton:!0},function(){f._invokeDataGridREST(e,r,t,a,n)}):f._invokeDataGridREST(e,r,t,a,n)}}},_showDataGridDlg:function(e,r,o){var t=r.grid.element.attr("data-items");if(t)for(var a=t.split(","),s=0;s<a.length;s++)if(a[s]){var n=a[s].split(":");if(3===n.length){GM.Form.parameters.urlParams[n[2]]=r.entity[n[0]];break}}GM.Form.formScope.showFormDialog(null,o),_this._getData(o,!0)},_invokeDataGridREST:function(e,r,o,t,a){if(RESTURL.dg&&RESTURL.dg[o]){var s=this,n=r.grid.element.attr("formid"),i=r.grid.element.attr("data-items"),c=r.grid.element.attr("ui-grid");c&&(c=c.replace("Option",""));var l={};if(i)for(var m=i.split(","),f=0;f<m.length;f++)if(m[f]){var p=m[f].split(":");if(3===p.length){l[p[2]]=r.entity[p[0]];break}}(t&&"POST"==t.toUpperCase()?GM.Form.restful.post(RESTURL.dg[o],l):GM.Form.restful.get(RESTURL.dg[o],l)).then(function(r){!0===r.success&&n&&c?s._getSingleDataGrid(e,n,c):!1===r.success&&GM.Form.CommonOper.showFailureMsg(r.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})}else GM.Form.CommonOper.showFailureMsg("未配置["+o+"]服务。")},_dataGridSelect:function(e,r){var o=r.grid.element.attr("ui-grid");if(o){var t=e[(o=o.replace("Option",""))+"KeyParas"];if(t&&t.length>0)for(var a=0;a<t.length;a++)GM.Form.parameters.urlParams[t[a].para]=r.entity[t[a].key];e.gridQueryParams&&e.gridQueryParams.queryType&&e.gridQueryParams.queryValue&&(GM.Form.parameters.urlParams.searchType=e.gridQueryParams.queryType,GM.Form.parameters.urlParams.searchValue=e.gridQueryParams.queryValue)}this._getData(!1,!0),e.closeFormDialog()},_getSingleDataGrid:function(e,r,o){var t=this,a=angular.copy(GM.Form.parameters.urlParams);a.ywh||(a.ywh=a.did||a.duuid),e.gridQueryParams.queryValue&&(a.queryType=e.gridQueryParams.queryType,a.queryValue=e.gridQueryParams.queryValue,e.gridQueryParams={queryType:"",queryValue:""});var s={up:a},n={formids:r,dataSourceName:o,urlParameters:JSON.stringify(s)};GM.Form.restful.get(GM.Form.parameters.servers.getSingleDataGridServer,n).then(function(r){!0===r.success&&r.data&&t._bindDataGrid(e,o,r.data)},function(e){})},_getGridOption:function(e,r,o,t,a,s){var n=r+"Option";e[n]={};var i={},c=new GM.Form.gmTable,l=[],m=[];if(s)for(var f=s.split(","),p=0;p<f.length;p++)if(""!=f[p]){var u=f[p].split(":");l.push({name:u[1],click:u[0]})}if(a){f=a.split(",");var d=[];for(p=0;p<f.length;p++)if(""!=f[p]){u=f[p].split(":");m.push({name:u[0],displayName:u[1],enableColumnMenu:!1,cellTooltip:!0}),3===u.length&&d.push({key:u[0],para:u[2]})}d.length>0&&(e[r+"KeyParas"]=d)}else if(t&&t.length>0)for(p=0;p<t.length;p++)m.push({name:t[p],displayName:t[p],enableColumnMenu:!1,cellTooltip:!0});if(l.length>0){var g=c.getCellTemplate(l);m.push({name:"operate",displayName:"操作",enableColumnMenu:!1,cellTemplate:g})}i.data=o,i.columnDefs=m,e[n]=i,c.updateSize()},_bindDataGrid:function(e,r,o){for(var t in o)if(!r||t==r||t=="page__"+r){if(0===t.indexOf("dg__"))if(o[t]instanceof Array)"landtree"!=e.pstyle&&!0!==e.isDataComplex||!e.globalTreeData[t]||(e.globalTreeData[t]=o[t]);else{var a=o[t],s=$("div[ui-grid='"+t+"Option']").attr("data-items"),n=$("div[ui-grid='"+t+"Option']").attr("template-items");this._getGridOption(e,t,a.data.page.records,a.headList,s,n)}t&&0===t.indexOf("page__")&&(e[t]=o[t])}},_getDraftData:function(e){GM.Form.restful.get(RESTURL.process.getDraftInfo+"?id="+e).then(function(e){!0===e.success&&null!=e.data&&(GM.Form.formScope.result=JSON.parse(e.data))},function(e){})},_saveDraft:function(e){var r={id:e,userId:top.GM.userInfo.loginName,appId:top.GM.AppInfo.id,processDefId:GM.Form.parameters.urlParams.processDefId,processName:GM.Form.parameters.urlParams.processName,processKey:GM.Form.parameters.urlParams.processKey},o=angular.element("[data-role='bizname']");o&&o>0&&(r.bizName=o.val()),GM.Form.restful.get(RESTURL.process.saveDraftBaseInfo,r).then(function(o){!0===o.success&&(r={id:e,data:_this._getSavingData()},GM.Form.restful.post(RESTURL.process.saveDraftInfo,r).then(function(e){!0===e.success?GM.Form.CommonOper.showSuccessMsg("保存成功！"):GM.Form.CommonOper.showFailureMsg(e.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)}))},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})},_getData:function(e,r){var o=this,t={formids:e||GM.Form.parameters.formIds.join(","),urlParameters:JSON.stringify(GM.Form.parameters.urlParams)};GM.Form.restful.get(GM.Form.parameters.servers.getDataServer,t).then(function(e){if(!1!==e.success){if(o._datas.globe=e.data,console.log(o._datas.globe),console.log(GM.Form.formScope.result),o._datas.globe.treeKey)for(var t in o._datas.globe)"treeKey"==t||o._datas.globe.treeKey[t]||(GM.Form.formScope.result[t]=o._datas.globe[t]);else if(r)for(var t in GM.Form.formScope.result)t.indexOf("dg__")<0?o._datas.globe[t]&&!$.isEmptyObject(o._datas.globe[t])&&$.isEmptyObject(GM.Form.formScope.result[t])&&(GM.Form.formScope.result[t]=o._datas.globe[t]):0===t.indexOf("dg__")?o._datas.globe[t].data.page.records.length>0&&0===GM.Form.formScope.result[t].data.page.records.length&&(GM.Form.formScope.result[t]=o._datas.globe[t]):0===t.indexOf("page__")&&o._datas.globe[t].totalItems>0&&0===GM.Form.formScope.result[t].totalItems&&(GM.Form.formScope.result[t]=o._datas.globe[t]);else GM.Form.formScope.result=o._datas.globe;if(o._bindDataGrid(GM.Form.formScope,null,o._datas.globe),GM.CommonOper.isStrNullOrEmpty(GM.Form.formScope.result.sc_spxx.SHRYXM)&&(GM.Form.formScope.result.sc_spxx.SHRYXM=GM.userInfo.realName),GM.CommonOper.isStrNullOrEmpty(GM.Form.formScope.result.sc_spxx.SHJSSJ)){var a=new Date,s=GM.CommonOper.getFormatData(a.getTime());GM.Form.formScope.result.sc_spxx.SHJSSJ=s}}else GM.Form.CommonOper.showFailureMsg("页面加载数据失败："+e.message)},function(e){GM.Form.CommonOper.showFailureMsg("页面加载数据失败："+e.message)})},_getSavingData:function(){var e;return e=this._datas.globe.treeKey?angular.copy(this._datas.globe):angular.copy(GM.Form.formScope.result),e=JSON.stringify(e)},_saveDialog:function(){if(GM.Form.formScope.dialogParameter.formid){var e={};if(angular.copy(GM.Form.parameters.urlParams,e),GM.Form.formScope.dialogParameter.params)for(var r in GM.Form.formScope.dialogParameter.params)e[r]=GM.Form.formScope.dialogParameter.params[r];var o={formids:GM.Form.formScope.dialogParameter.formid,urlParameters:JSON.stringify(e),keys:JSON.stringify(this._datas.saveKeys),data:this._getSavingData()};GM.Form.CommonOper.syncAjaxPost(GM.Form.parameters.servers.saveDataServer,function(e){!0===e.success?GM.Form.CommonOper.showSuccessMsg("保存成功"):GM.Form.CommonOper.showFailureMsg(e.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)},o)}},_saveData:function(e,r,o){var t={urlParameters:JSON.stringify(GM.Form.parameters.urlParams),keys:JSON.stringify(this._datas.saveKeys),data:this._getSavingData()};GM.Form.parameters.savingFormIds&&GM.Form.parameters.savingFormIds.length>0?t.formids=GM.Form.parameters.savingFormIds.join(","):t.formids=GM.Form.parameters.formIds.join(","),GM.Form.CommonOper.syncAjaxPost(GM.Form.parameters.servers.saveDataServer,function(t){if(!0===t.success){if(r)return void r();!0===e?GM.Form.formScope.handOver():GM.Form.CommonOper.showSuccessMsg("保存成功")}else o&&o(),GM.Form.CommonOper.showFailureMsg(t.message)},function(e){o&&o(),GM.Form.CommonOper.showFailureMsg(e.message)},t)}}},"./src/form/core/base/form-engine.js":function(module,exports,__webpack_require__){"use strict";__webpack_require__("./src/form/core/base/api.js"),__webpack_require__("./src/form/core/base/workflow.js"),__webpack_require__("./src/form/core/base/form-data.js"),__webpack_require__("./src/form/core/base/form-webgis.js"),GM.Form.formScope=void 0,GM.Form.restful=void 0,GM.Form.validationObject=void 0,GM.Form.ngDialog=void 0,GM.Form.gmTable=void 0,GM.Form.filter=void 0,GM.Form.timeout=void 0,GM.Form.parameters={appId:void 0,serviceAppKey:void 0,urlParams:void 0,userInfo:{realName:null==top.GM.userInfo?"":top.GM.userInfo.realName,loginName:null==top.GM.userInfo?"":top.GM.userInfo.loginName},dataLoaded:!1,formValid:!0,formIds:[],savingFormIds:[],saveLayerName:void 0,servers:{getDataServer:void 0,saveDataServer:void 0,getHandOverVarServer:void 0,updateBizFlowInfoServer:void 0,getSingleDataGridServer:void 0},formDataSourceNames:[]},GM.Form.FormEngine={_functions:{beforeGetData:[],afterGetData:[],pageLoaded:[]},_initScopeVar:function(){GM.Form.formScope.settings={layoutUrl:void 0,forms:[],tabs:[],prints:[],buttons:[],topUrl:void 0,showBottom:!1,loadWebGIS:!1},GM.Form.formScope.draftInfo={key:void 0},GM.Form.formScope.dataLoaded=!1,GM.Form.formScope.hasInitCalcs=!1},init:function(e,r,o,t,a,s,n){if(GM.Form.parameters.urlParams=GM.LayoutOper.getURLParams(window.location.href),GM.Form.parameters.appId=GM.Form.parameters.urlParams.appId,GM.Form.parameters.serviceAppKey=GM.Form.parameters.urlParams.serviceAppKey,GM.Form.parameters.urlParams.serviceAppKey)for(var i in GM.Form.parameters.servers)GM.Form.parameters.servers[i]=this._getFormServiceUrl(GM.Form.parameters.urlParams.serviceAppKey)+FORM_REST_URL.form[i];GM.Form.formScope=e,GM.Form.restful=r,GM.Form.validationObject=o,GM.Form.filter=t,GM.Form.ngDialog=a,GM.Form.gmTable=s,GM.Form.timeout=n,this._initScopeVar(),GM.Form.formScope?top.GM.userInfo?(this._loadPage(),this._bindEvents(),this._doAfterLoadPage(GM.Form.formScope)):this.showFailureMsg("无法获取登录用户信息！"):this.showFailureMsg("无法初始化上下文！")},getAppServerUrl:function(e){var r=this._getFormServiceUrl(e||GM.Form.parameters.urlParams.serviceAppKey);if(r)return"/"==r.substring(r.length-1,r.length)&&(r=r.substring(0,r.length-1)),r.substring(0,r.lastIndexOf("/"))},_doAfterLoadPage:function(e){var r=this;GM.Form.timeout(function(){$(".nav li a[data-target]").each(function(){var e=$(this).attr("data-target").replace("#",""),r=GM.Form.CommonOper.getUUID(),o=$(this).parent("li").parent("ul").parent("div").next(".div-content").find("div[id='"+e+"']");o.length>0&&(o.attr("id",r),$(this).attr("data-target","#"+r))}),!1===e.hasInitCalcs&&angular.element("[calc-exp]").length>0&&(r._watchCalcExp(e),e.hasInitCalcs=!0)},500)},_getFormServiceUrl:function(e){var r=null;if(null==r)try{for(var o=0;o<CONFIG_JSON.length;o++)if(e===CONFIG_JSON[o].app){r=CONFIG_JSON[o].value+"form/";break}}catch(e){r=FORM_SERVER,console.log(e)}return r},_bindEvents:function(){var e=this;GM.Form.formScope.invokePlugin=function(r,o){e._clickEvent(r,o)},GM.Form.formScope.treeConfig={activeNode:"treeEvent"},GM.Form.formScope.treeEvent=function(r){e._treeConfig(GM.Form.formScope,r)},GM.Form.formScope.print=function(r,o){e._print(o||GM.Form.formScope.taskInfo.bizKey,r,top.GM.AppInfo.id)},GM.Form.formScope.showFormDialog=function(r,o,t,a){e._showFormDialog(GM.Form.formScope,r,o,t,a)},GM.Form.formScope.closeFormDialog=function(){Dialog.close()},GM.Form.formScope.formLoaded=function(){e._formLoaded(GM.Form.formScope)},GM.Form.formScope.isCbChecked=function(r,o){return e._isCheckBoxChecked(GM.Form.formScope,r,o)},GM.Form.formScope.cbCheck=function(r,o,t){e._cbCheck(GM.Form.formScope,r,o,t)},GM.Form.formScope.$watch("dataLoaded",function(){!0===GM.Form.formScope.dataLoaded&&!1===GM.Form.formScope.hasInitCalcs&&angular.element("[calc-exp]").length>0&&(e._watchCalcExp(GM.Form.formScope),GM.Form.formScope.hasInitCalcs=!0)})},_watchCalcExp:function _watchCalcExp(scope){var _this=this;if(angular.element(":text[calc-exp='user'][ng-model],textarea[calc-exp='user'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}vCur&&""!=vCur||GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,top.GM.userInfo.realName)})}),angular.element(":text[calc-exp='userid'][ng-model],textarea[calc-exp='userid'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}vCur&&""!=vCur||GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,top.GM.userInfo.loginName)})}),angular.element(":text[calc-exp='sysdate'][ng-model],textarea[calc-exp='sysdate'][ng-model]").each(function(){var sUserNgModel=$(this).attr("ng-model");scope.$watch(sUserNgModel,function(){var vCur;try{vCur=eval("GM.Form.formScope."+sUserNgModel)}catch(e){}if(!vCur||""==vCur){var dt=new Date,vYear=dt.getFullYear(),vMonth=(dt.getMonth()<9?"0":"")+(dt.getMonth()+1),vDate=(dt.getDate()<10?"0":"")+dt.getDate(),vSysDate=vYear+"-"+vMonth+"-"+vDate;GM.Form.CommonOper.setObjectAttrVal(scope,sUserNgModel,0,vSysDate)}})}),angular.element("[calc-exp][calc-exp!='user'][calc-exp!='userid'][calc-exp!='sysdate']").length>0){var arrCalcOpers=["+","-","*","/","^","%","(",")"];angular.element("[calc-exp][calc-exp!='user'][calc-exp!='userid'][calc-exp!='sysdate']").each(function(){var sCalcExp=$(this).attr("calc-exp"),isCn=0===sCalcExp.indexOf("cn(");isCn&&(sCalcExp=sCalcExp.substring(3,sCalcExp.length-1));for(var sModel=$(this).attr("ng-model"),sDigits=$(this).attr("digits"),arrEleBinds=[],curEleBind="",sNewCalcExp="",i=0;i<sCalcExp.length;i++)arrCalcOpers.containsObj(sCalcExp[i])||i===sCalcExp.length-1?(""!=curEleBind&&(i===sCalcExp.length-1&&(curEleBind+=sCalcExp[i]),arrEleBinds.push(curEleBind),curEleBind=""),sNewCalcExp+=sCalcExp[i],i<sCalcExp.length-1&&!arrCalcOpers.containsObj(sCalcExp[i+1])&&(sCalcExp[i+1]<"0"||sCalcExp[i+1]>"9")&&(sNewCalcExp+="GM.Form.formScope.")):(0===i&&(sCalcExp[i]<"0"||sCalcExp[i]>"9")&&(sNewCalcExp="GM.Form.formScope."),curEleBind+=sCalcExp[i],sNewCalcExp+=sCalcExp[i]);for(var i=0;i<arrEleBinds.length;i++)scope.$watch(arrEleBinds[i],function(){for(var curVal,curSign="",sLastExp="",isString=!1,uu=0;uu<sNewCalcExp.length;uu++)if(arrCalcOpers.containsObj(sNewCalcExp[uu])||uu===sNewCalcExp.length-1)if(uu===sNewCalcExp.length-1&&(curSign+=sNewCalcExp[uu]),""!=curSign){try{curVal=eval(curSign)}catch(e){curVal=void 0}var vLastOper=uu===sNewCalcExp.length-1?"":sNewCalcExp[uu];curVal?isNaN(curVal)?(sLastExp+=curVal,!1===isString&&(isString=!0)):sLastExp+=parseFloat(curVal).toFixed(6)+vLastOper:sLastExp+="0"+vLastOper,curSign=""}else sLastExp+=sNewCalcExp[uu];else curSign+=sNewCalcExp[uu];try{if(!0===isString)GM.Form.CommonOper.setObjectAttrVal(scope,sModel,0,sLastExp);else if(sDigits&&""!=sDigits&&(sLastExp="("+sLastExp+").toFixed("+sDigits+").trimNumber()"),isCn)eval("GM.Form.formScope."+sModel+"='"+formCommonOper.getCnFormatMoney(eval(sLastExp))+"'");else try{var vCalResult=eval(sLastExp);"NaN"==vCalResult&&(vCalResult=""),GM.Form.CommonOper.setObjectAttrVal(scope,sModel,0,vCalResult)}catch(e){}}catch(e){}})})}},_cbCheck:function(e,r,o,t){if(t&&""!=t)for(var a=angular.element(r.target).prop("checked"),s=o.split("."),n=e,i=0;i<s.length;i++){if(a&&!n[s[i]])n[s[i]]=i<s.length-1?{}:t;else if(i==s.length-1){var c=n[s[i]].split(",");a&&!GM.CommonOper.isArrayContainsEle(c,t)?c.push(t):!a&&GM.CommonOper.isArrayContainsEle(c,t)&&GM.CommonOper.removeItemFromArray(c,t),n[s[i]]=c.join(",")}n=n[s[i]]}},_formLoaded:function(e){var r=[];angular.element("[ui-grid]").each(function(){r.push(angular.element(this).attr("ui-grid").replace("Option",""))}),GM.Form.FormData._initOptions(e,r)},_isCheckBoxChecked:function(e,r,o){if(!r||""==r||!o||""==o)return!1;for(var t=r.split("."),a=e,s=0;s<t.length;s++){if(!a[t[s]])return!1;a=a[t[s]]}if(!a||""==a)return!1;var n=a.split(",");return GM.CommonOper.isArrayContainsEle(n,o)},_showFormDialog:function(e,r,o,t,a){var s={formid:o,buttons:a};if(e.dialogParameter=s,e.initedDlgFormIds||(e.initedDlgFormIds=[]),GM.CommonOper.isArrayContainsEle(e.initedDlgFormIds,o)?e.initedDlgFormIds.push(o):e.initDataGridOptions(o),e.formInfos||(e.formInfos=[]),!r){for(var n=0;n<e.formInfos.length;n++)if(e.formInfos[n].formid==o){r=e.formInfos[n].url;break}r||GM.Form.CommonOper.syncAjaxGet(window.FORM_REST_URL.workflow.getFormInfoById+"?formid="+o,function(t){!0===t.success&&t.data&&(r="views/forms/"+t.data.dir,e.formInfos.push({formid:o,url:r}))},function(e){})}Dialog=GM.Form.ngDialog.open({template:r,scope:e})},_print:function(e,r,o){var t={code:r,appid:o,param:e},a=FORM_REST_URL.workflow.print;GM.Form.restful.post(a,t).then(function(e){if(!0===e.success&&e.data)for(var r=e.data.split(";"),o=0;o<r.length;o++)if(""!==r[o]){var t=r[o].replace(/\\/g,"/");0===t.indexOf("./")?t=t.substring(1,t.length):0!==t.indexOf("/")&&(t="/"+t),top.window.open(FORM_REST_URL.workflow.printResultUrl+t)}})},_treeConfig:function(e,r){e.treeFormKey=pNode.formid+";"+pNode.sxh+";"+pNode.subtype},_clickEvent:function(e,r){var o=this,t=r.split(",");"goBack"==r?o._doClick(t):top.GM.LayoutOper.validateForm(GM.Form.validationObject,e.allForms,function(){GM.Form.formScope.settings.formValid=!0,o._doClick(t)},function(){GM.Form.formScope.settings.formValid=!1,GM.Form.CommonOper.showFailureMsg("表单验证不通过，请先根据页面提示进行修改")})},_doClick:function _doClick(names){0!==names.length&&(eval("GM.Form.formScope."+names[0]+"()"),names.splice(0,1),this._doClick(names))},_pushFormId:function(e){GM.CommonOper.addUniqueEle(GM.Form.parameters.formIds,e)},_pushSavingFormId:function(e){GM.CommonOper.addUniqueEle(GM.Form.parameters.savingFormIds,e)},_getPages:function(e){var r=[];return this._retrievePages(r,e),r},_retrievePages:function(e,r){for(var o=0;o<r.length;o++)r[o].children?this._retrievePages(e,r[o].children):(r[o].formid&&"map"!=r[o].formid&&(this._pushFormId(r[o].formid),!0!==r[o].save&&"true"!=GM.LayoutOper.getParamsValue(r[o].url,"readonly")||this._pushSavingFormId(r[o].formid)),e.push(r[o]))},_getLayoutUrl:function(e){return 0===(e=e||"tab").indexOf("url:")?e.substring(4,e.length):STATIC_RESOURCES_PATH+"core-views/layout/"+e+".html"},_loadPage:function(){var e,r=this;(GM.Form.Workflow.init(),GM.Form.parameters.urlParams.formid)?(GM.Form.formScope.settings.layoutUrl=r._getLayoutUrl("raw"),r._pushFormId(GM.Form.parameters.urlParams.formid),GM.Form.parameters.dataLoaded=!0):(GM.Form.formScope.taskInfo.bizKey?(GM.Form.formScope.settings.topUrl=STATIC_RESOURCES_PATH+"core-views/layout/top.html",e="views/"+GM.Form.formScope.taskInfo.processKey+"/"+GM.Form.formScope.taskInfo.taskKey+".json",GM.Form.formScope.settings.showBottom="查看"!=GM.Form.formScope.taskInfo.name):(e="views/"+GM.Form.parameters.urlParams.processKey+"/起草.json",GM.Form.formScope.settings.showBottom=!0),GM.Form.CommonOper.syncAjaxGet(e,function(e){if(GM.Form.formScope.settings.layoutUrl=r._getLayoutUrl(e.style?e.style:"raw"),GM.Form.formScope.settings.tabs=e.tabs,GM.Form.formScope.settings.forms=r._getPages(e.tabs),GM.Form.formScope.settings.buttons=e.buttons,GM.Form.formScope.settings.prints=e.prints,GM.Form.formScope.settings.loadWebGIS=!!e.webgis,GM.Form.formScope.settings.forms&&GM.Form.formScope.settings.forms.length>0)for(var o=0;o<GM.Form.formScope.settings.forms.length;o++)GM.Form.formScope.settings.forms[o].formid&&(r._pushFormId(GM.Form.formScope.settings.forms[o].formid),!0===GM.Form.formScope.settings.forms[o].save&&r._pushSavingFormId(GM.Form.formScope.settings.forms[o].formid))},function(e){}))}}},"./src/form/core/base/form-webgis.js":function(e,r,o){"use strict";window.formWebgis={init:function(){GM.Form.formScope.graphStat={}},savePlots:function(e,r,o){var t={ywh:e,strParams:JSON.stringify(r),asDraft:!0===o?"1":"0"};return GM.Form.restful.post(RESTURL.graph.savePlots,null,t)},saveGraphStatics:function(){if(GM.Form.parameters.saveLayerName){var e=[],r=[],o={layerName:GM.Form.parameters.saveLayerName},t=!1,a=null;if(GM.Form.formScope.graphStat.hasOwnProperty("polygon")&&(e=GM.Form.formScope.graphStat.polygon,t=GM.GIS.ExternalApi.saveJXPolygons(e,GM.Form.formScope),a=GM.GIS.ExternalApi.getJhObjectIDName()),!1===t)return!1;GM.Form.formScope.graphStat.statistics&&(o.statistics=GM.Form.formScope.graphStat.statistics);for(var s=0;s<e.length;s++){var n=e[s].feature&&e[s].feature.get(a)?e[s].feature.get(a):void 0;n=n&&""!=n?n:e[s].objectid,r.push({polygonNum:e[s].polygonNum,area:e[s].area,name:e[s].name,strGeom:e[s].strGeom,objectid:n})}return o.polygon=r,GM.Form.formScope.saveGraphParam=o,!0}}}},"./src/form/core/base/workflow.js":function(module,exports,__webpack_require__){"use strict";__webpack_require__("./src/form/core/base/api.js"),__webpack_require__("./src/form/office/services/agency-services.js"),GM.Form.Workflow={init:function init(){var _this=this;GM.Form.formScope.taskInfo={bizKey:GM.Form.parameters.urlParams.ywh,draftBizKey:GM.Form.parameters.urlParams.did||GM.Form.parameters.urlParams.duuid,processDefId:GM.Form.parameters.urlParams.processDefId,processKey:GM.Form.parameters.urlParams.processKey,processName:GM.Form.parameters.urlParams.processName,taskKey:GM.Form.parameters.urlParams.taskKey,isClaimed:!1,bizName:GM.Form.parameters.urlParams.caseTitle,startTime:void 0,forbid:!1,boxName:GM.Form.parameters.urlParams.box||"agency"},GM.Form.formScope.handOver=function(){Dialog=GM.Form.ngDialog.open({template:STATIC_RESOURCES_PATH+"core-views/handOver.html",scope:GM.Form.formScope})},GM.Form.formScope.startProcessAndHandOver=function(){GM.Form.formScope.startProcess(!0,!0)},GM.Form.formScope.startProcess=function(autoHandOver,notTurnToFirst){var ctrlCaseTitle=$("[data-role='bizname']");if(ctrlCaseTitle&&0!==ctrlCaseTitle.length)if(ctrlCaseTitle=ctrlCaseTitle.val(),ctrlCaseTitle&&""!=ctrlCaseTitle){var param={appId:GM.Form.parameters.appId,userId:GM.Form.parameters.userInfo.loginName,processDefId:GM.Form.parameters.urlParams.processDefId,title:ctrlCaseTitle};GM.Form.formScope.taskInfo.draftBizKey&&(param.draftKey=GM.Form.formScope.taskInfo.draftBizKey);var ctrlExtraBizDatas=angular.element("[data-role='biz-data']"),extraBizData;if(ctrlExtraBizDatas.length>0)for(var y=0;y<ctrlExtraBizDatas.length;y++){var sModel=$(ctrlExtraBizDatas[y].attr("ng-model"));if(sModel){var arr=sModel.split(".");arr.length>0&&(extraBizData||(extraBizData={}),extraBizData[arr[arr.length-1]]=eval("GM.Form.formScope."+sModel))}}extraBizData&&(param.extraBizData=extraBizData),_this._startProcess(param).then(function(e){if(!0===e.success&&(GM.Form.parameters.urlParams.ywh=e.data.bizKey,GM.Form.formScope.taskInfo.taskKey=e.data.currentTaskId,GM.Form.formScope.taskInfo.bizKey=e.data.bizKey,GM.Form.formScope.taskInfo.bizName=e.data.caseTitle,GM.Form.formScope.taskInfo.startTime=e.data.startTime,GM.Form.formScope.taskInfo.isClaimed=!0,!0===autoHandOver?GM.Form.formScope.saveAndHandOver():GM.Form.formScope.save(),_this.saveBizFlowInfo("",e.data.bizKey),!notTurnToFirst)){var r="";for(var o in GM.Form.parameters.urlParams)r+="&"+o+"="+GM.Form.parameters.urlParams[o];window.location=r.replace(/&/,"?")+"&taskKey="+GM.Form.formScope.taskInfo.taskKey}},function(e){})}else GM.Form.CommonOper.showFailureMsg("案卷标题不能为空！");else GM.Form.CommonOper.showFailureMsg("缺少用于案卷标题的控件！")},GM.Form.formScope.claimOrUnclaim=function(e){var r,o,t;"claim"===e?(r="确认签收？",o=FORM_REST_URL.workflow.claimTask,t="签收失败"):(r="确认放弃？",o=FORM_REST_URL.workflow.unclaimTask,t="放弃签收失败"),GM.Alert.show(r,"",null,function(){GM.Form.restful.post(o,null,{bizKey:GM.Form.formScope.taskInfo.bizKey,taskKey:GM.Form.formScope.taskInfo.taskKey,userId:GM.Form.parameters.userInfo.id}).then(function(e){if(e.success){var r="";for(var o in GM.Form.parameters.urlParams)r+="&"+o+"="+GM.Form.parameters.urlParams[o];window.location=r.replace(/&/,"?")+"&taskKey="+GM.Form.formScope.taskInfo.taskKey}else GM.Infomation.show(t,{type:"warning"})},function(e){GM.Infomation.show(e,{type:"warning"})})})},GM.Form.formScope.showWfGraph=function(){GM.Form.formScope.blankTitle="流程图",GM.Form.formScope.htmlContent='<img src="'+FORM_REST_URL.workflow.getHighLightTask+"?bizKey="+GM.Form.formScope.taskInfo.bizKey+'" style="margin-top:30px;"/>',Dialog=GM.Form.ngDialog.open({template:STATIC_RESOURCES_PATH+"core-views/model/blank.html",scope:GM.Form.formScope})},this._isTaskClaimed(),this._initBizFlowDetails()},_initBizFlowDetails:function(){var e=this;GM.Form.formScope.pendingPageLz={currentPage:1},GM.Form.formScope.$watch("pendingPageLz.currentPage",function(){GM.Form.formScope.pendingPageLz.currentPage>0&&e._getLzData()}),GM.Form.formScope.lzGridOptions={};GM.Form.formScope.lzGridOptions.columnDefs=[{name:"taskKey",displayName:"当前环节",enableColumnMenu:!1,cellTooltip:!0},{name:"assigneeName",displayName:"办理人员",enableColumnMenu:!1,cellTooltip:!0},{name:"previousTaskKey",displayName:"前一环节",enableColumnMenu:!1,cellTooltip:!0},{name:"submitterName",displayName:"发件人员",enableColumnMenu:!1,cellTooltip:!0},{name:"startTime",displayName:"接收时间",enableColumnMenu:!1,cellTooltip:!0},{name:"completeTime",displayName:"转送时间",enableColumnMenu:!1,cellTooltip:!0},{name:"yj",displayName:"预警",enableColumnMenu:!1,cellTemplate:'<span style="display:block;padding:5px;color:#3280fc">正常</span>'}],GM.Form.formScope.showLzDialog=function(){Dialog=GM.Form.ngDialog.open({template:STATIC_RESOURCES_PATH+"core-views/model/liuzhuan-modal.html",scope:GM.Form.formScope,className:"ngdialog-theme-default custom"}),e._getLzData()},GM.Form.formScope.viewMap=function(){var e=GM.Form.formScope.result.zrzyjbxx.ZRZYDJDYH,r=GM.LayoutOper.addURLParam(ONEMAP_PATH,"ProjectType","zrzy");r=GM.LayoutOper.addURLParam(r,"ZRZYDJDYH",e),GM.FullModal.show("地图",r)},GM.Form.formScope.closeDialog=function(){Dialog.close()}},_getLzData:function(){var e=window.FORM_REST_URL.workflow.getTaskTrackPage+"?current="+GM.Form.formScope.pendingPageLz.currentPage+"&orderField=START_TIME&bizKey="+GM.Form.formScope.taskInfo.bizKey;GM.Form.restful.get(e,function(e){if(!0===e.success){var r=e.data.records;angular.forEach(r,function(e,r){e.index=r+1,e.startTime=GM.Form.filter("date")(e.startTime,"yyyy-MM-dd HH:mm:ss"),e.completeTime=GM.Form.filter("date")(e.completeTime,"yyyy-MM-dd HH:mm:ss")}),GM.Form.formScope.pendingPageLz.totalItems=e.data.total,GM.Form.formScope.lzGridOptions.data=e.data.records}},function(e){})},_isTaskClaimed:function(){var e=FORM_REST_URL.workflow.isClaimed+"?bizKey="+GM.Form.formScope.taskInfo.bizKey+"&taskkey="+encodeURIComponent(GM.Form.formScope.taskInfo.name);GM.Form.restful.get(e,null).then(function(e){GM.Form.formScope.taskInfo.isClaimed=!0===e.success},function(e){})},_startProcess:function(e){return GM.Form.restful.get(FORM_REST_URL.workflow.startProcess,e)},saveBizFlowInfo:function(e,r){GM.Form.restful.get(GM.Form.parameters.servers.updateBizFlowInfoServer+"?bizKey="+r+"&id="+e).then(function(e){},function(e){})}},window.workflowCore={}},"./src/form/core/config.js":function(e,r,o){"use strict";window.FORM_SERVER_URLS={},window.FORM_REST_URL={form:{getHandOverVarServer:"getHandOverVariables",getDataServer:"getData",saveDataServer:"saveData",getSingleDataGridServer:"getSingleDataGrid",updateBizFlowInfoServer:"updateBizFlowInfo"},workflow:{isClaimed:ACTIVITI_SERVER+"/usertask/isTaskClaimed",claimTask:ACTIVITI_SERVER+"/usertask/claimTask",unclaimTask:ACTIVITI_SERVER+"/usertask/unclaimTask",getHighLightTask:ACTIVITI_SERVER+"/usertask/getHighLightTask",startProcess:ACTIVITI_SERVER+"/usertask/startProcess",saveDataAsDraft:ACTIVITI_SERVER+"/usertask/saveDataAsDraft",getDraftData:ACTIVITI_SERVER+"/usertask/getDraftData",saveDraftInfo:ACTIVITI_SERVER+"/tdzz/saveDraftInfo",getDrafts:ACTIVITI_SERVER+"/tdzz/getDrafts",getRegionTree:ACTIVITI_SERVER+"/work/getRegionTree",getBizInfo:ACTIVITI_SERVER+"/usertask/getProcessInstance",getHandOverTarget:ACTIVITI_SERVER+"/usertask/getNextTasks",handOver:ACTIVITI_SERVER+"/usertask/handOver",getUUID:ACTIVITI_SERVER+"/usertask/getUUID",print:ACTIVITI_SERVER+"/bizconfig/print",getRedisString:ACTIVITI_SERVER+"/userdraft/getRedisString",removeRedisString:ACTIVITI_SERVER+"/userdraft/removeRedisString",redisString:ACTIVITI_SERVER+"/userdraft/redisString",getTaskTrackPage:ACTIVITI_SERVER+"/usertask/getTaskTrackPage",getDataGridDataSourceNames:ACTIVITI_SERVER+"/form/getDataGridDataSourceNames",getFormInfoById:ACTIVITI_SERVER+"/form/getFormInfoById",getProcessInstanceByBizKey:ACTIVITI_SERVER+"/usertask/getProcessInstanceByBizKey",printResultUrl:"http://192.168.5.222:8088/ftpdirectory"}}},"./src/form/core/controllers/file-controller.js":function(e,r,o){"use strict";o("./src/form/core/services/file-service.js"),angular.module("frameApp").controller("fileCtrl",["$scope","$location","$fileService","$captureService","ngDialog","$validation",function(e,r,o,t,a,s){var n=formBase.getUrlParamters(r.absUrl()),i=n.ywh,c=n.blbz;e.fileTreeConfig={activeNode:"activeNode",name:"filename"},e.activeNode=function(r){null!=r&&(null!=r.processDefId?e.activeFolder=!0:e.activeFolder=!1),e.pActiveNode=r},e.uploadFile=function(){$("#file_upload").click(),$("#file_upload").unbind().change(function(){var r=new FormData;r.append("multipartFile",this.files[0]),r.append("id",e.pActiveNode.id),r.append("dir",i+"\\"+e.pActiveNode.filename),r.append("isDraft",n.duuid||n.did?"1":"0");var t=GM.CommonOper.ajaxRequest(RESTURL.file.uploadFile,r,{type:"POST",cache:!1,processData:!1,contentType:!1});if(null==e.pActiveNode.children&&(e.pActiveNode.children=[]),null!=t.data&&null!=t.data.children&&0!=t.data.children.length){var a=t.data.children[0];a.filename=a.name,e.pActiveNode.children.push(a),e.$apply(e.pActiveNode),GM.Infomation.show("上传成功！")}$("#file_upload").val(""),e.fileTree=o.formatTreeData(e.fileTree,c,!0)})},e.editFolder=function(){e.copyFocusItem=angular.copy(e.pActiveNode)},e.deleteFolder=function(){GM.Alert.show("提示？","是否确认删除材料？",{showCancelButton:!0},function(){o.removeFolder(e.pActiveNode.id).then(function(r){GM.CommonOper.removeItemFromArray(e.fileTree,e.pActiveNode,"id"),GM.Infomation.show("删除成功！")},function(e){GM.Infomation.show("删除失败！"),$log.error(e)})})},e.deleteFile=function(){GM.Alert.show("提示？","是否确认删除文件？",{showCancelButton:!0},function(){o.removeFile(e.pActiveNode.id,e.pActiveNode.fileId).then(function(r){GM.TreeOper.removeNode(e.fileTree,e.pActiveNode),GM.Infomation.show("删除成功！")},function(e){GM.Infomation.show("删除失败！"),$log.error(e)})})},e.editFile=function(){e.copyFocusItem=angular.copy(e.pActiveNode)},e.viewFile=function(){var r=e.pActiveNode.url;"img"===GM.FilePath.getFileType(r)?e.imgUrl=r:window.open(r)},e.saveFile=function(){angular.copy(e.pActiveNode,e.copyFocusItem),o.saveFile(e.copyFocusItem).then(function(r){angular.copy(e.copyFocusItem,e.pActiveNode),GM.Infomation.show("修改成功！"),$("#fileModal").modal("hide")},function(e){GM.Infomation.show("修改失败！"),$log.error(e)})},e.addFolder=function(){Dialog=a.open({template:"folderModal.html",scope:e})},e.closeDialog=function(){a&&a.close()},e.saveFolder=function(r){GM.LayoutOper.validateForm(s,r.folderForm,function(){o.saveFolder(e.copyFocusItem).then(function(r){null==e.copyFocusItem.id?(e.fileTree.push(r.data),GM.Infomation.show("添加成功！")):(angular.copy(e.copyFocusItem,e.pActiveNode),GM.Infomation.show("修改成功！")),a.close()},function(r){null==e.focusItem?GM.Infomation.show("添加失败！"):GM.Infomation.show("修改失败！"),$log.error(r)})},function(){})},e.captureImg=function(){t.showCapture(e)}}])},"./src/form/core/controllers/form-controller.js":function(e,r,o){"use strict";o("./src/form/core/services/form-core-service.js"),o("./src/form/core/base/api.js"),o("./src/form/core/directives/tab-components.js"),o("./src/form/core/filters/workflow-filter.js"),angular.module("frameApp").controller("indexCtrl",["$scope","$http","$gmRestful",function(e,r,o){GM.token=top.GM.token;var t=new o;GM.FrameManager.prepareData(e,t);var a=GM.LayoutOper.getParamsValue(window.location.href,"ywh"),s=GM.LayoutOper.getParamsValue(window.location.href,"taskKey"),n=GM.LayoutOper.getParamsValue(window.location.href,"processKey"),i="views/"+n+"/"+(a?s:"起草")+".json",c=function(){var r=GM.LayoutOper.getParamsValue(window.location.href,"view");e.subUrl=r?"views/"+r+".html?"+window.location.href.split("?")[1]:STATIC_RESOURCES_PATH+"core-views/layout/formIndex.html"};if(!a||s||n)GM.Form.CommonOper.syncAjaxGet(i,function(o){!function(o){var t="";if(o.tabs&&o.tabs.length>0){for(var a=[],s=0;s<o.tabs.length;s++)a.push(o.tabs[s].formid);t=a.join(",")}e.formIds=t,t?r.get(window.FORM_REST_URL.workflow.getDataGridDataSourceNames+"?formids="+t).then(function(e){!0===e.data.success&&(GM.Form.parameters.formDataSourceNames=e.data.data),c()},function(e){console.log(e)}):(GM.LayoutOper.getParamsValue(window.location.href,"view"),c())}(o)},function(e){});else{var l=window.FORM_REST_URL.workflow.getProcessInstanceByBizKey+"?bizKey="+encodeURIComponent(a),m=GM.LayoutOper.getParamsValue(window.location.href,"box");GM.Form.CommonOper.syncAjaxGet(l,function(e){if(e&&!0===e.success&&e.data){var r=e.data;r.processDef&&r.processDef.processDefinitionId&&(n=r.processDef.processDefinitionId.split(":")[0],l="index.html?appId="+GM.AppInfo.id+"&serviceAppKey="+r.processDef.serviceAppKey+"&box="+m+"&ywh="+a+"&processKey="+n+"&processDefId="+encodeURIComponent(r.processDef.processDefinitionId)+"&taskKey="+encodeURIComponent("查看")+"&processName="+encodeURIComponent(r.processDef.processName)+"&caseTitle="+encodeURIComponent(r.caseTitle),window.location=l)}},function(e){document.write("无法获取业务详情。")})}e.closeDlg=function(){$("button.close[data-dismiss]",window.parent.document).click()}}]),angular.module("frameApp").controller("formCtrl",["$scope","$http","$location","$timeout","$formCoreService","$rootScope","$filter","ngDialog","$validation","$gmTable",function(e,r,o,t,a,s,n,i,c,l){e.$on("$includeContentLoaded",function(e,r){var o=GM.LayoutOper.getURLParams(r);e.targetScope.readonly="true"===o.readonly}),a.loadPage(e,c,n,i,l,t)}])},"./src/form/core/controllers/handover-controller.js":function(e,r,o){"use strict";o("./src/form/core/services/handover-service.js"),angular.module("frameApp").controller("handOverCtrl",["$scope","$handOverService",function(e,r){r.loadPage(e)}])},"./src/form/core/directives/tab-components.js":function(e,r,o){"use strict";angular.module("frameApp").directive("tabTop",function(){return{restrict:"EAC",template:'<div class="form-top-div clearfix"><div class="form-top-left pull-left"><div ng-if="!taskInfo.forbid"><h3>项目类型：{{taskInfo.processName}}&nbsp;&nbsp;&nbsp;当前节点：{{taskInfo.taskKey}}</h3>流程状态：<span class="label"ng-if="!taskInfo.isClaimed">未签收</span><span class="label label-success"ng-if="taskInfo.isClaimed">已签收</span></div><div ng-if="taskInfo.forbid"><h3>项目类型：{{taskInfo.processName}}</div></div><div class="form-top-right pull-right"ng-init="operatList = true"ng-init="print = true"><div class="dropdown"><i class="icon icon-list-ul more"data-toggle="dropdown"title="菜单"></i><ul class="dropdown-menu pull-right"><li class="dropdown"ng-if="!taskInfo.forbid && !taskInfo.isClaimed"ng-click="claim(true);"><a href="javascript:;">签收</a></li><li class="dropdown"ng-if="!taskInfo.forbid && taskInfo.isClaimed"ng-click="claim(false)"><a href="javascript:;">放弃</a></li><li class="divider"></li><li class="dropdown-submenu"ng-click="showWfGraph()"><a href="javascript:;">流程图</a></li><li class="divider"></li><li class="dropdown"><a href="javascript:;">打印</a><ul class="dropdown-menu pull-left"><li ng-repeat="item in printItems"><a href="javascript:;"ng-click="print(item.code)">{{item.name}}</a></li></ul></li><li class="divider"></li><li class="dropdown"ng-click="viewMap()"><a href="javascript:;">定位</a></li></ul></div></div></div><hr style="margin-top: 0">',link:function(e,r,o,t){}}})},"./src/form/core/filters/workflow-filter.js":function(e,r,o){"use strict";angular.module("frameApp").filter("to_trusted",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}])},"./src/form/core/services/file-service.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$fileService",["$gmRestful",function(e){return{getDraftAttaches:function(r,o,t,a){return(new e).get(RESTURL.file.getDraftAttaches,{draftBizKey:r,processKey:o,taskKey:t,subType:a})},getAttachesFromRedis:function(r,o,t,a){return(new e).get(RESTURL.file.getAttachesFromRedis,{draftBizKey:r,processKey:o,taskKey:t,subType:a})},queryTree:function(r,o,t){return(new e).get(RESTURL.file.queryTree,{ywh:r,zlx:o,sxh:t})},saveFolder:function(r){return(new e).post(RESTURL.file.saveFolder,{},r)},removeFolder:function(r){return(new e).post(RESTURL.file.deleteFolder,{},{id:r})},removeFile:function(r,o){return(new e).post(RESTURL.file.deleteFile,{},{id:r,fileId:o,status:1})},saveFile:function(r){return(new e).post(RESTURL.file.saveFile,{},r)},formatTreeData:function(e,r,o){if(null!=e){for(var t=GM.TreeOper.getAllNodes(e),a=0;a<t.length;a++){var s=t[a];if(s.processDefId)if(s.parent=!0,!1===this._isFileEnable(s,r,o)){if(s.nodeType="disabled",null!=s.children&&s.children.length>0)for(var n=0;n<s.children.length;n++){s.children[n].nodeType=s.nodeType}}else!0!==this._isFileNecessary(s)||null!=s.children&&0!==s.children.length?s.nodeType="default":s.nodeType="error";else s.filename=s.name}return e}},initTree:function(e,r,o,t,a,s){var n=this,i=t||"",c=a||"";s.duuid?n.getDraftAttaches(r,s.processid,o,i).then(function(r){var o=n.formatTreeData(r.data,s.blbz,!0);e.fileTree=o}):s.did?n.getAttachesFromRedis(r,s.processid,o,i).then(function(r){var o=n.formatTreeData(r.data,s.blbz,!0);e.fileTree=o}):n.queryTree(r,i,c).then(function(r){var o=n.formatTreeData(r.data,s.blbz,!0);e.fileTree=o})},_isFileEnable:function(e,r,o){return 0!=o},_isFileNecessary:function(e){return!0}}}]),angular.module("frameApp").factory("$captureService",["$gmRestful",function(e){var r=new e,o=function(){var e=$(window).height(),r=650;r>e&&(r=e);var o=(r-115)/.75+35+300;$(".oa-capture-dialog").dialog({title:"材料扫描",modal:!0,width:o,height:r})};return GM.DotNetCapture={showDialog:function(e){this.$scope=e,this.$scope.tableData=[],this.options={camera:0,resolution:0},this._innitLayout(),this._initEvent(),o()},_innitLayout:function(){this._modifyLayout(),null==this.device_camera&&(this.device_camera=$("#CaptureView")[0]),this.device_camera.CameraStop(),this.device_camera.Init();var e=this.device_camera.getDeviceNames();if(e){for(var r=e.split(";"),o=0;o<r.length;o++)GM.CommonOper.isStrNullOrEmpty(r[o])&&(GM.CommonOper.removeItemFromArray(r,r[o]),o--);this.$scope.arrayCameras=r}this.device_camera.CameraConn(this.options.camera,this.options.resolution),this.$scope.selectCamera=String(this.options.camera),this.$scope.arrayResolutions=this._getResolutions(),this.$scope.selectResolution=String(this.options.resolution)},_modifyLayout:function(){$("#CaptureView").remove(),$(".oa-capture-view").append('<OBJECT ID="CaptureView" CLASSID="CLSID:A14B31B4-C560-4DF7-A30C-59A3AE8C598D" style="height:100%;width:100%"></OBJECT>'),"CLSID:A14B31B4-C560-4DF7-A30C-59A3AE8C598D"!==$("#CaptureView").attr("CLASSID")&&($("#CaptureView").remove(),$(".oa-capture-view").append('<OBJECT ID="CaptureView" CLASSID="CLSID:A14B31B4-C560-4DF7-A30C-59A3AE8C598D" style="height:100%;width:100%"></OBJECT>'))},_initEvent:function(){var e=this;this.$scope.chooseCamera=function(r){var o=Number(e.$scope.selectCamera);Number(e.$scope.selectResolution);e.device_camera.CameraConn(o,0),e.$scope.arrayResolutions=e._getResolutions(),e.$scope.selectResolution="0"},this.$scope.chooseResolution=function(r){var o=Number(e.$scope.selectCamera),t=Number(e.$scope.selectResolution);e.device_camera.CameraConn(o,t)},this.$scope.updateCamera=function(){e.updateDevice()},this.$scope.shoot=function(){var r=e.device_camera.MakeCapture();r&&e.$scope.tableData.push({name:e.$scope.tableData.length+1,strBase64:r,uploadStatus:"待上传"}),e.updateDevice()},this.$scope.reshoot=function(){e.$scope.view="camera"},this.$scope.viewImg=function(r){e.$scope.view="img",e.$scope.imgBase64=r.strBase64},this.$scope.deleteItem=function(r){GM.CommonOper.removeItemFromArray(e.$scope.tableData,r)},this.$scope.uploadFile=function(){for(var o=0;o<e.$scope.tableData.length;o++){var t=e.$scope.tableData[o];if("待上传"===t.uploadStatus){var a=r.ajax(RESTURL.file.uploadBase64,t);if(a&&!0===a.success){t.uploadStatus,null==e.$scope.pActiveNode.children&&(e.$scope.pActiveNode.children=[]);var s=a.data;e.$scope.pActiveNode.children.push(s)}}}},$(".oa-capture-dialog").on("dialogbeforeclose",function(){e.destory()}),$(window).unbind("beforeunload",GM.DotNetCapture.destory).bind("beforeunload",GM.DotNetCapture.destory)},_getResolutions:function(){var e=this.device_camera.getVideoResolutions();return e?e.split(";"):null},updateDevice:function(){this.destory(),null==this.device_camera&&(this.device_camera=$("#CaptureView")[0]),this.device_camera.CameraStop(),this.device_camera.Init();var e=Number(this.$scope.selectCamera),r=Number(this.$scope.selectResolution);this.device_camera.CameraConn(e,r)},destory:function(){GM.DotNetCapture.device_camera&&(GM.DotNetCapture.device_camera.CameraStop(),GM.DotNetCapture.device_camera=null)}},{showCapture:function(e){switch(e.capture={},this.getVertion()){case"LiangTian":case"FangZheng":case"JieYuA16D":case"JieYuJYP6008T":break;default:GM.DotNetCapture.showDialog(e)}},getVertion:function(){return""}}}])},"./src/form/core/services/form-core-service.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$formCoreService",["$gmRestful",function(e){return{loadPage:function(r,o,t,a,s,n){GM.Form.FormEngine.init(r,new e,o,t,a,s,n),GM.Form.FormData.init(r.formIds),r.getData()}}}])},"./src/form/core/services/handover-service.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$handOverService",["$gmRestful",function(e){return{loadPage:function(e){var r=this;e.taskInfo&&e.taskInfo.hasOwnProperty("taskKey")&&e.taskInfo.taskKey?(e.result={},e.nextNodes=[],e.handOverConfig={name:"name",children:"childrens",checkNode:"checkItem"},r._bindEvents(e),r._getHandOverChecks(e.taskInfo.processDefId,e.taskInfo.taskKey,e.taskInfo.bizKey).then(function(o){!0===o.success&&(e.handOverVar=o.data,r._getHandOverTarget(e.taskInfo.processDefId,e.taskInfo.taskKey,o.data).then(function(r){if(!0===r.success&&r.data&&null!=r.data){e.nextNodes=r.data,e.isOnlyLastNode=1===r.data.length&&"__结束__"==r.data[0].node;for(var o=[],t=angular.copy(r.data),a=0;a<t.length;a++)if(o[a]={name:t[a].node,childrens:t[a].groups},t[a].groups)for(var s=0;s<t[a].groups.length;s++)o[a].childrens[s]={name:t[a].groups[s].name,id:t[a].groups[s].id,childrens:t[a].groups[s].users};e.chooseRole=o}else r.message&&GM.Form.CommonOper.showFailureMsg(r.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)}))},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})):GM.Form.CommonOper.showFailureMsg("无法获取移交相关参数！")},_bindEvents:function(e){var r=this;e.checkItem=function(o){r._checkItem(e,o)},e.modelHandOver=function(){r._doHandOver(e)},e.unselectUser=function(o,t,a){r._unselect(e,o,t,a)}},_checkItem:function(e,r){if(e.selectedUsers=[],r instanceof Array)for(var o=0;o<r.length;o++)"3"==r[o].flag&&this._selectUser(e,r[o].node,r[o].id,r[o].name);else r&&"3"==r.flag&&this._selectUser(e,r.node,r.id,r.name)},_selectUser:function(e,r,o,t){for(var a={id:o,name:t},s=!1,n=0;n<e.selectedUsers.length;n++)if(e.selectedUsers[n].node&&e.selectedUsers[n].node==r){if(!GM.CommonOper.isArrayContainsEle(e.selectedUsers[n].users,a)){var i=e.selectedUsers[n].users||[];i.push(a),e.selectedUsers[n].users=i}s=!0;break}s||e.selectedUsers.push({node:r,users:[a]})},_unselect:function(e,r,o,t){this._uncheckTreeUser(e,r,o,t);for(var a=0;a<e.selectedUsers.length;a++)if(e.selectedUsers[a].node&&e.selectedUsers[a].node==r){var s=e.selectedUsers[a].users,n={id:o,name:t};GM.CommonOper.removeItemFromArray(s,n,"id"),0===s.length?e.selectedUsers.splice(a,1):e.selectedUsers[a].users=s}},_uncheckUserOnTree:function(e,r,o,t){if(e.childrens&&e.childrens.length>0)for(var a=0;a<e.childrens.length;a++)this._uncheckUserOnTree(e.childrens[a],r,o,t);else"3"==e.flag&&e.id==o&&e.node==r&&(e.check=!1)},_uncheckTreeUser:function(e,r,o,t){for(var a=0;a<e.chooseRole.length;a++)this._uncheckUserOnTree(e.chooseRole[a],r,o,t)},_doHandOver:function(e){if(e.isOnlyLastNode&&!0===e.isOnlyLastNode||e.selectedUsers&&0!==e.selectedUsers.length){var r=this,o={userId:top.GM.userInfo.loginName,bizKey:e.taskInfo.bizKey,taskKey:e.taskInfo.taskKey,variables:e.handOverVar};if(!0!==e.isOnlyLastNode){for(var t={target:[]},a=null,s=0;s<e.selectedUsers.length;s++)a=GM.Form.CommonOper.mapFieldArray(e.selectedUsers[s].users,"id"),t.target.push({node:e.selectedUsers[s].node,users:a});o.targets=JSON.stringify(t)}this._handOver(o).then(function(o){if(!0===o.success){o.data&&r._saveBizFlowInfo(o.data,e.taskInfo.bizKey);var t=!0===e.isOnlyLastNode?"流程已结束！":"移交成功！";GM.Form.CommonOper.showSuccessMsg(t),GM.Form.formScope.closeDialog();var a=e.handOverParam&&e.handOverParam.boxName;top.goPendingPage(a)}else GM.Form.CommonOper.showFailureMsg(o.message)},function(e){GM.Form.CommonOper.showFailureMsg(e.message)})}else GM.Form.CommonOper.showFailureMsg("请先选择移交对象！")},_getBizInfo:function(r,o,t){return e().get(FORM_REST_URL.workflow.getBizInfo,{userId:r,bizKey:o,taskKey:t})},_getHandOverChecks:function(r,o,t){return e().get(GM.Form.parameters.servers.getHandOverVarServer,{processDefId:r,taskKey:o,bizKey:t})},_getHandOverTarget:function(r,o,t){return e().get(FORM_REST_URL.workflow.getHandOverTarget,{processDefId:r,taskKey:o,var:JSON.stringify(t)})},_handOver:function(r){return e().post(FORM_REST_URL.workflow.handOver,r)},_saveBizFlowInfo:function(e,r){GM.Form.CommonOper.syncAjaxGet(GM.Form.parameters.servers.updateBizFlowInfoServer+"?bizKey="+r,function(e){},function(e){})}}}])},"./src/form/form.js":function(e,r,o){"use strict";o("./src/form/core/config.js"),o("./src/form/core/base/form-engine.js"),o("./src/form/core/controllers/file-controller.js"),o("./src/form/core/controllers/form-controller.js"),o("./src/form/core/controllers/handover-controller.js"),o("./src/form/office/controllers/agency-ctrl.js"),o("./src/form/office/controllers/complete-ctrl.js"),o("./src/form/office/controllers/draft-ctrl.js"),o("./src/form/office/controllers/protocol-ctrl.js")},"./src/form/office/controllers/agency-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/agency-services.js"),angular.module("frameApp").controller("agencyCtrl",["$scope","$rootScope","$agencyService","$filter",function(e,r,o,t){var a=GM.userInfo.loginName,s=GM.AppInfo.id;function n(){o.queryPendingData(e.agencyForm).then(function(r){var o=r.data.records;angular.forEach(o,function(e,r){e.index=r+1,e.startTime=t("date")(e.startTime,"yyyy-MM-dd HH:mm:ss")}),e.userData.data.page.records=o,e.pendingPage.totalItems=r.data.total},function(e){GM.Infomation.show(e.message,{type:"warning"})})}e.agencyForm={userId:a,appId:s,orderField:"startTime"},e.$watch("pendingPage.currentPage",function(){e.pendingPage.currentPage>0&&(e.agencyForm.current=e.pendingPage.currentPage,n())}),e.pendingPage.currentPage=1,e.tagData={tags:[{name:"计划待办",value:"计划待办"},{name:"实施待办",value:"实施待办"},{name:"验收待办",value:"验收待办"}],checkTag:"checkTag"},e.checkTag=function(r){e.agencyForm.xmjd=[];for(var o=0;o<r.length;o++)e.agencyForm.xmjd.push(r[o].value);n()},e.userData={config:{taskKey:{type:"a",click:"goProcess"}},data:{page:{},head:{index:"序号",bizKey:"案卷编号",bizName:"案卷名称",processName:"项目类型",startTime:"提交时间",submitterName:"提交人",taskKey:"当前环节"}},headList:["index","bizKey","bizName","processName","startTime","submitterName","taskKey"]};e.refer=function(){n()},e.delet=function(){e.agencyForm={userId:a},n()},e.goProcess=function(e){console.log(e),r.processUrl=o.getHtmlPath()+"?appId="+s+"&serviceAppKey="+e.serviceAppKey+"&box=agency&ywh="+e.bizKey+"&processKey="+e.processKey+"&processDefId="+e.processDefId+"&taskKey="+encodeURIComponent(e.taskKey?e.taskKey:"起草")+"&processName="+encodeURIComponent(e.processName)+"&caseTitle="+encodeURIComponent(e.bizName),$("[ng-controller='agencyCtrl'] *").hide(),$("[ng-controller='agencyCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="agencyCtrl"></iframe>'),window.agencyCtrl.location.href=r.processUrl},e.goPending=function(){e.activeNaviFromPath("/agency",!0)}}])},"./src/form/office/controllers/complete-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/agency-services.js"),angular.module("frameApp").controller("completeCtrl",["$scope","$rootScope","$agencyService","$filter",function(e,r,o,t){var a=GM.userInfo.loginName,s=GM.AppInfo.id;function n(){o.queryCompleteData(e.completeForm).then(function(r){var o=r.data.records;angular.forEach(o,function(e,r){e.index=r+1,e.completeTime=t("date")(e.completeTime,"yyyy-MM-dd")}),e.userData.data.page.records=o,e.pendingPage.totalItems=r.data.total},function(e){GM.Infomation.show(e.message,{type:"warning"})})}e.completeForm={userId:a,appId:s,orderField:"completeTime"},e.pendingPage={currentPage:1},e.$watch("pendingPage.currentPage",function(){e.pendingPage.currentPage>0&&(e.completeForm.current=e.pendingPage.currentPage,n())}),e.pendingPage.currentPage=1,e.tagData={tags:[{name:"计划阶段",value:0},{name:"实施阶段",value:1},{name:"验收阶段",value:2}],checkTag:"checkTag"},e.checkTag=function(r){e.completeForm.xmjd=[];for(var o=0;o<r.length;o++)e.completeForm.xmjd.push(r[o].name);n()},e.userData={config:{operate:[{name:"查看",icon:"icon-edit",click:"goProcess"}]},data:{page:{},head:{index:"序号",bizKey:"案卷编号",bizName:"案卷名称",processName:"项目类型",taskKey:"已办环节",completeTime:"提交时间",targetTaskKey:"接收环节",receiverName:"接收人"}},headList:["index","bizKey","bizName","processName","taskKey","completeTime","targetTaskKey","receiverName"]},e.refer=function(){n()},e.delet=function(){e.completeForm={userId:a},n()},e.goProcess=function(e){console.log(e),r.processUrl="forms/index.html?appId="+s+"&serviceAppKey="+e.serviceAppKey+"&box=complete&ywh="+e.bizKey+"&processKey="+e.processKey+"&processDefId="+e.processDefId+"&taskKey="+encodeURIComponent("查看")+"&processName="+encodeURIComponent(e.processName)+"&caseTitle="+encodeURIComponent(e.bizName),$("[ng-controller='completeCtrl'] *").hide(),$("[ng-controller='completeCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="completeCtrl"></iframe>'),window.completeCtrl.location.href=r.processUrl},e.goPending=function(){e.activeNaviFromPath("/complete",!0)}}])},"./src/form/office/controllers/draft-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/services/draft-services.js"),angular.module("frameApp").controller("draftCtrl",["$scope","$location","$rootScope","$draftService","$agencyService","$log",function(e,r,o,t,a,s){var n=GM.userInfo.loginName;function i(){a.queryDraftData(e.draftForm).then(function(r){var o=r.data.page.records;angular.forEach(o,function(e,r){e.index=r+1}),e.userData.data.page.records=o,e.pendingPage.totalItems=r.data.page.total},function(e){GM.Infomation.show(e.message,{type:"warning"})})}e.draftForm={userId:n},e.regions=GM.userInfo.areas,e.treearea={name:"title",children:"childrens",attvalue:"code"},e.pendingPage={currentPage:1},e.$watch("pendingPage.currentPage",function(){e.pendingPage.currentPage>0&&(e.draftForm.current=e.pendingPage.currentPage,i())}),e.pendingPage.currentPage=1,e.tagData={tags:[{name:"一般开发项目",value:"一般开发项目"},{name:"专项基金开发项目",value:"专项基金开发项目"},{name:"一般整理项目",value:"一般整理项目"},{name:"国土部门高标准项目",value:"国土部门高标准项目"},{name:"其它部门高标准项目",value:"其它部门高标准项目"},{name:"一般复垦项目",value:"一般复垦项目"},{name:"采空区复垦",value:"采空区复垦"},{name:"矿业用地存量复垦",value:"矿业用地存量复垦"}],checkTag:"checkTag"},e.checkTag=function(r){e.draftForm.xmjd=[];for(var o=0;o<r.length;o++)e.draftForm.xmjd.push(r[o].value);i()},e.userData={config:{operate:[{name:"编辑",icon:"icon-edit",click:"goProcess"}]},data:{page:{},head:{index:"序号",xmysubh:"预算编号",xmmc:"项目名称",xzqmc:"项目位置",zgm:"总规模",ztz:"总投资",xmjd:"项目阶段",xmlx:"项目类型"}},headList:["index","xmysubh","xmmc","xzqmc","zgm","ztz","xmjd","xmlx"]},e.refer=function(){i()},e.delet=function(){e.draftForm={userId:n},i()},e.goPending=function(){e.activeNaviFromPath("/draft",!0)},e.goProcess=function(e){o.processUrl=a.getHtmlPath()+"?did="+e.id+"&box=draft&processid="+encodeURIComponent(e.processKey),$("[ng-controller='draftCtrl'] *").hide(),$("[ng-controller='draftCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="draftCtrl"></iframe>'),window.draftCtrl.location.href=o.processUrl}}])},"./src/form/office/controllers/protocol-ctrl.js":function(e,r,o){"use strict";o("./src/form/office/controllers/protocol-ctrl.js"),angular.module("frameApp").controller("protocolCtrl",["$scope","$rootScope","$protocolService","$agencyService","$log",function(e,r,o,t,a){if(top.GM.userInfo&&0!==top.GM.userInfo.permissions.length){o.queryDraft(top.GM.AppInfo.id,top.GM.userInfo.permissions.join(",")).then(function(r){e.draftData=r.data},function(e){a.error(e)}),e.draftProcess=function(e){o.getUUID(null).then(function(r){r&&!0===r.success?s(e,r.data):s(e,"unknown")},function(r){s(e,"unknown")})},e.goPending=function(){e.activeNaviFromPath("/protocol",!0)};var s=function(e,o){var a=e.processDefinitionId.split(":")[0];r.processUrl=t.getHtmlPath()+"?startFlag=1&duuid="+o+"&box=protocol&appId="+top.GM.AppInfo.id+"&serviceAppKey="+e.serviceAppKey+"&processKey="+a+"&processDefId="+e.id+"&processName="+encodeURIComponent(e.processName),$("[ng-controller='protocolCtrl'] *").hide(),$("[ng-controller='protocolCtrl']").append('<iframe frameborder="0" height="100%" width="100%" name ="protocolCtrl"></iframe>'),window.protocolCtrl.location.href=r.processUrl}}else GM.Infomation.show("无法获取当前用户权限！",{type:"danger",placement:"center"})}])},"./src/form/office/services/agency-services.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$agencyService",["$gmRestful",function(e){return{queryExtraBizFields:function(r){return(new e).get(ACTIVITI_SERVER+"usertask/getExtraBizFields?appId="+r)},queryStartData:function(r){return(new e).get(RESTURL.process.start,r)},queryPendingData:function(r){return(new e).get(ACTIVITI_SERVER+"usertask/list/handling",r)},getQuery:function(r){return(new e).get(RESTURL.process.query,r)},processDate:function(e){var r=new Date(e);return[r.getFullYear(),r.getMonth()+1,r.getDate()].join("-")},queryCompleteData:function(r){return(new e).get(ACTIVITI_SERVER+"usertask/list/handled",r)},queryDraftData:function(r){return(new e).get(ACTIVITI_SERVER+"userdraft/getDraftInfo",r)},getHtmlPath:function(){return"forms/index.html","forms/index.html"},getProcessCatalogs:function(r,o){return(new e).get(RESTURL.wf.getProcessCatalogs+(o?"?id="+o:""),r)},edit:function(r){return(new e).post(RESTURL.wf.editProcessCatalog,r)},delete:function(r,o){return(new e).get(RESTURL.wf.deleteProcessCatalog+"?id="+o,r)}}}])},"./src/form/office/services/draft-services.js":function(e,r,o){"use strict";angular.module("frameApp").factory("$draftService",["$gmRestful",function(e){return{queryPendingData:function(r){return(new e).get(ACTIVITI_SERVER+"userdraft/getDraftInfo",r)}}}])}},["./src/form/form.js"]);
//# sourceMappingURL=form-7ea2d.bundle.js.map